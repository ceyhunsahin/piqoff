"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[2099],{42099:(t,e,n)=>{n.r(e),n.d(e,{default:()=>v});var s=n(4942),i=n(15861),r=n(15671),o=n(43144),a=n(97326),c=n(60136),l=n(82963),d=n(61120),E=n(64687),h=n.n(E),u=n(67294),O=n(73364),b=n(4598),m=(n(30381),n(42866)),T=n.n(m),C=n(53221),p=n.n(C),g=n(25552),_=n.n(g),D=(n(65580),n(91686),n(30886),n(99846)),f=(n(5083),n(99077)),R=(n(55585),n(417)),S=(n(32175),n(18405)),I=n(73682),U=(n(90428),n(57941),n(60547));function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){(0,s.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n(17276),n(51166);var v=function(t){(0,c.Z)(v,t);var e,n,s,E,m,C,x=(m=v,C=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,d.Z)(m);if(C){var n=(0,d.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function v(t){var e;return(0,r.Z)(this,v),(e=x.call(this,t)).core=O.Z.instance.core,e.prmObj=e.param.filter({TYPE:1,USERS:e.user.CODE}),e.acsobj=e.access.filter({TYPE:1,USERS:e.user.CODE}),e.docObj=new b.Ch,e._btnGetClick=e._btnGetClick.bind((0,a.Z)(e)),e._btnSave=e._btnSave.bind((0,a.Z)(e)),e._toGroupByCustomer=e._toGroupByCustomer.bind((0,a.Z)(e)),e.txtRef=Math.floor(Date.now()/1e3),e.tabIndex=t.data.tabkey,e}return(0,o.Z)(v,[{key:"componentDidMount",value:function(){var t=this;setTimeout((0,i.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Init();case 1:case"end":return e.stop()}}),e)}))),1e3)}},{key:"Init",value:(E=(0,i.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.docObj.clearAll(),this.txtRef=Math.floor(Date.now()/1e3),this.txtCustomerCode.CODE="";case 3:case"end":return t.stop()}}),t,this)}))),function(){return E.apply(this,arguments)})},{key:"_btnGetClick",value:(s=(0,i.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={source:{select:{query:"SELECT ITEMS_VW_01.GUID AS ITEM_GUID, ITEMS_VW_01.NAME AS ITEM_NAME, ITEMS_VW_01.CODE AS ITEM_CODE, ISNULL(ITEM_MULTICODE_VW_01.CUSTOMER_PRICE,0) AS CUSTOMER_PRICE, ISNULL(ITEM_MULTICODE_VW_01.VAT_RATE,0)  AS VAT_RATE, ISNULL(ITEM_MULTICODE_VW_01.CUSTOMER_NAME,'')  AS CUSTOMER_NAME, ISNULL(ITEM_MULTICODE_VW_01.CUSTOMER_CODE ,'')AS CUSTOMER_CODE, ISNULL(ITEM_MULTICODE_VW_01.CUSTOMER_GUID ,'00000000-0000-0000-0000-000000000000')AS CUSTOMER_GUID, [dbo].[FN_DEPOT_QUANTITY](ITEMS_VW_01.GUID,@DEPOT,GETDATE()) AS QUANTITY FROM ITEMS_VW_01 LEFT OUTER JOIN  ITEM_MULTICODE_VW_01 ON ITEMS_VW_01.GUID = ITEM_MULTICODE_VW_01.ITEM_GUID WHERE [dbo].[FN_DEPOT_QUANTITY](ITEMS_VW_01.GUID,@DEPOT,GETDATE()) > 0   AND      ((ITEM_MULTICODE_VW_01.CUSTOMER_CODE = @CUSTOMER_CODE) OR (@CUSTOMER_CODE = '')) ",param:["DEPOT:string|50","CUSTOMER_CODE:string|50"],value:[this.cmbDepot.value,this.txtCustomerCode.CODE]},sql:this.core.sql}},t.next=3,this.grdRebateList.dataRefresh(e);case 3:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"_btnSave",value:(n=(0,i.Z)(h().mark((function t(e){var n,s,i,r,o,a,c,l,d,E,O,b,m,T,C,p,g,_;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.grdRebateList.getSelectedData().length)){t.next=10;break}if(""!=this.grdRebateList.getSelectedData()[n].CUSTOMER_NAME){t.next=7;break}return s={id:"msgCustomerFound",showTitle:!0,title:this.t("msgCustomerFound.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgCustomerFound.btn01"),location:"after"}],content:u.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgCustomerFound.msg"))},t.next=6,(0,U.W)(s);case 6:return t.abrupt("return");case 7:n++,t.next=1;break;case 10:return t.next=12,this._toGroupByCustomer(this.grdRebateList.getSelectedData(),"ITEM_CODE");case 12:i=t.sent,r=0;case 14:if(!(r<Object.values(i).length)){t.next=23;break}if(!(Object.values(i)[r].length>1)){t.next=20;break}return o={id:"msgDublicateItem",showTitle:!0,title:this.t("msgDublicateItem.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgDublicateItem.btn01"),location:"after"}],content:u.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},Object.values(i)[r][0].ITEM_NAME+" "+this.t("msgDublicateItem.msg"))},t.next=19,(0,U.W)(o);case 19:return t.abrupt("return");case 20:r++,t.next=14;break;case 23:return a={id:"msgSave",showTitle:!0,title:this.t("msgSave.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgSave.btn01"),location:"before"},{id:"btn02",caption:this.t("msgSave.btn02"),location:"after"}],content:u.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgSave.msg"))},t.next=26,(0,U.W)(a);case 26:if("btn02"!=t.sent){t.next=29;break}return t.abrupt("return");case 29:return t.next=31,this._toGroupByCustomer(this.grdRebateList.getSelectedData(),"CUSTOMER_GUID");case 31:c=t.sent,l=0;case 33:if(!(l<Object.keys(c).length)){t.next=76;break}return d={query:"Select CODE,ISNULL((SELECT (MAX(REF_NO) + 1) FROM DOC_VW_01 WHERE DOC_TYPE = 40 AND REBATE = 1 AND DOC_VW_01.INPUT = CUSTOMERS.GUID),1) AS REF_NO FROM CUSTOMERS WHERE GUID = @GUID ",param:["GUID:string|50"],value:[Object.keys(c)[l]]},t.next=37,this.core.sql.execute(d);case 37:if(E=t.sent,O=E.result.recordset[0].CODE,b=E.result.recordset[0].REF_NO,"00000000-0000-0000-0000-000000000000"==Object.keys(c)[l]){t.next=73;break}0==e?((m=M({},this.docObj.empty)).TYPE=1,m.DOC_TYPE=40,m.REBATE=1,m.REF=O,m.REF_NO=b,m.OUTPUT=this.cmbDepot.value,m.INPUT=Object.keys(c)[l],this.docObj.addEmpty(m)):1==e&&((T=M({},this.docObj.empty)).TYPE=1,T.DOC_TYPE=20,T.REBATE=1,T.REF=O,T.REF_NO=b,T.OUTPUT=this.cmbDepot.value,T.INPUT=Object.keys(c)[l],this.docObj.addEmpty(T),(C=M({},this.docObj.docCustomer.empty)).DOC_GUID=this.docObj.dt()[this.docObj.dt().length-1].GUID,C.TYPE=this.docObj.dt()[this.docObj.dt().length-1].TYPE,C.DOC_TYPE=this.docObj.dt()[this.docObj.dt().length-1].DOC_TYPE,C.REBATE=this.docObj.dt()[this.docObj.dt().length-1].REBATE,C.REF=this.docObj.dt()[this.docObj.dt().length-1].REF,C.REF_NO=this.docObj.dt()[this.docObj.dt().length-1].REF_NO,C.DOC_DATE=this.docObj.dt()[this.docObj.dt().length-1].DOC_DATE,C.OUTPUT=this.docObj.dt()[this.docObj.dt().length-1].OUTPUT,C.INPUT=this.docObj.dt()[this.docObj.dt().length-1].INPUT,this.docObj.docCustomer.addEmpty(C)),p=0;case 43:if(!(p<this.grdRebateList.getSelectedData().length)){t.next=73;break}if(Object.keys(c)[l]!=this.grdRebateList.getSelectedData()[p].CUSTOMER_GUID){t.next=70;break}return(g=M({},this.docObj.docItems.empty)).DOC_GUID=this.docObj.dt()[this.docObj.dt().length-1].GUID,g.TYPE=this.docObj.dt()[0].TYPE,g.DOC_TYPE=this.docObj.dt()[0].DOC_TYPE,g.REBATE=this.docObj.dt()[0].REBATE,g.LINE_NO=this.docObj.docItems.dt().length,g.REF=this.docObj.dt()[this.docObj.dt().length-1].REF,g.REF_NO=this.docObj.dt()[this.docObj.dt().length-1].REF_NO,g.INPUT=Object.keys(c)[l],g.OUTPUT=this.cmbDepot.value,g.DOC_DATE=this.docObj.dt()[this.docObj.dt().length-1].DOC_DATE,g.SHIPMENT_DATE=this.docObj.dt()[this.docObj.dt().length-1].SHIPMENT_DATE,g.ITEM=this.grdRebateList.getSelectedData()[p].ITEM_GUID,g.ITEM_NAME=this.grdRebateList.getSelectedData()[p].ITEM_NAME,g.PRICE=this.grdRebateList.getSelectedData()[p].CUSTOMER_PRICE,g.QUANTITY=this.grdRebateList.getSelectedData()[p].QUANTITY,g.AMOUNT=this.grdRebateList.getSelectedData()[p].CUSTOMER_PRICE*this.grdRebateList.getSelectedData()[p].QUANTITY,g.VAT=g.AMOUNT*(this.grdRebateList.getSelectedData()[p].VAT_RATE/100),g.TOTAL=g.AMOUNT+g.VAT,this.docObj.dt()[this.docObj.dt().length-1].AMOUNT=g.AMOUNT+this.docObj.dt()[this.docObj.dt().length-1].AMOUNT,this.docObj.dt()[this.docObj.dt().length-1].VAT=g.VAT+this.docObj.dt()[this.docObj.dt().length-1].VAT,this.docObj.dt()[this.docObj.dt().length-1].TOTAL=g.TOTAL+this.docObj.dt()[this.docObj.dt().length-1].TOTAL,1==e&&(this.docObj.docCustomer.dt()[this.docObj.docCustomer.dt().length-1].AMOUNT=this.docObj.dt()[this.docObj.dt().length-1].TOTAL),t.next=70,this.docObj.docItems.addEmpty(g);case 70:p++,t.next=43;break;case 73:l++,t.next=33;break;case 76:return _={id:"msgSaveResult",showTitle:!0,title:this.t("msgSave.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgSave.btn01"),location:"after"}]},t.next=79,this.docObj.save();case 79:if(t.t0=t.sent,0!=t.t0){t.next=89;break}return _.content=u.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"green"}},this.t("msgSaveResult.msgSuccess")),t.next=84,(0,U.W)(_);case 84:this.docObj.clearAll(),this.txtRef=Math.floor(Date.now()/1e3),this._btnGetClick(),t.next=92;break;case 89:return _.content=u.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"red"}},this.t("msgSaveResult.msgFailed")),t.next=92,(0,U.W)(_);case 92:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"_toGroupByCustomer",value:(e=(0,i.Z)(h().mark((function t(e,n){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.reduce((function(t,e){var s=e[n];return t[s]||(t[s]=[]),t[s].push(e),t}),{}));case 1:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})},{key:"render",value:function(){var t,e=this;return u.createElement("div",null,u.createElement(T(),null,u.createElement("div",{className:"row px-2 pt-2"},u.createElement("div",{className:"col-12"},u.createElement(p(),null,u.createElement(g.Item,{location:"after",locateInMenu:"auto",widget:"dxButton",options:{type:"default",icon:"clear",onClick:(t=(0,i.Z)(h().mark((function t(){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:"msgClose",showTitle:!0,title:e.lang.t("msgWarning"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.lang.t("btnYes"),location:"before"},{id:"btn02",caption:e.lang.t("btnNo"),location:"after"}],content:u.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.lang.t("msgClose"))},t.next=3,(0,U.W)(n);case 3:"btn01"==t.sent&&O.Z.instance.panel.closePage();case 5:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}})))),u.createElement("div",{className:"row px-2 pt-2"},u.createElement("div",{className:"col-12"},u.createElement(_(),{colCount:2,id:"frmCriter"},u.createElement(g.Item,null,u.createElement(g.Label,{text:this.t("cmbDepot"),alignment:"right"}),u.createElement(f.ZP,{simple:!0,parent:this,id:"cmbDepot",dt:{data:this.docObj.dt("DOC"),field:"OUTPUT"},displayExpr:"NAME",valueExpr:"GUID",value:"",searchEnabled:!0,notRefresh:!0,onValueChanged:(0,i.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this),data:{source:{select:{query:"SELECT * FROM DEPOT_VW_01 WHERE TYPE = 1"},sql:this.core.sql}},param:this.param.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE})},u.createElement(D.cX,{validationGroup:"frmSalesDis"+this.tabIndex},u.createElement(D.n2,{message:this.t("validDepot")})))),u.createElement(g.EmptyItem,null),u.createElement(g.Item,null,u.createElement(g.Label,{text:this.t("txtCustomerCode"),alignment:"right"}),u.createElement(D.ZP,{id:"txtCustomerCode",parent:this,simple:!0,notRefresh:!0,onEnterKey:(0,i.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.pg_txtCustomerCode.setVal(e.txtCustomerCode.value);case 2:e.pg_txtCustomerCode.show(),e.pg_txtCustomerCode.onClick=function(t){t.length>0&&(e.txtCustomerCode.setState({value:t[0].TITLE}),e.txtCustomerCode.CODE=t[0].CODE)};case 4:case"end":return t.stop()}}),t)}))).bind(this),button:[{id:"01",icon:"more",onClick:function(){e.pg_txtCustomerCode.show(),e.pg_txtCustomerCode.onClick=function(t){t.length>0&&(e.txtCustomerCode.setState({value:t[0].TITLE}),e.txtCustomerCode.CODE=t[0].CODE)}}},{id:"02",icon:"clear",onClick:function(){e.txtCustomerCode.setState({value:""}),e.txtCustomerCode.CODE=""}}]}),u.createElement(R.Z,{id:"pg_txtCustomerCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("pg_txtCustomerCode.title"),search:!0,data:{source:{select:{query:"SELECT GUID,CODE,TITLE,NAME,LAST_NAME,[TYPE_NAME],[GENUS_NAME] FROM CUSTOMER_VW_01 WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(TITLE) LIKE UPPER(@VAL)",param:["VAL:string|50"]},sql:this.core.sql}},button:{id:"01",icon:"more",onClick:function(){console.log(1111)}}},u.createElement(S.sg,{dataField:"CODE",caption:this.t("pg_txtCustomerCode.clmCode"),width:150}),u.createElement(S.sg,{dataField:"TITLE",caption:this.t("pg_txtCustomerCode.clmTitle"),width:500,defaultSortOrder:"asc"}),u.createElement(S.sg,{dataField:"TYPE_NAME",caption:this.t("pg_txtCustomerCode.clmTypeName"),width:150}),u.createElement(S.sg,{dataField:"GENUS_NAME",caption:this.t("pg_txtCustomerCode.clmGenusName"),width:150,filterType:"include",filterValues:["Tedarikçi"]})))))),u.createElement("div",{className:"row px-2 pt-2"},u.createElement("div",{className:"col-3"},u.createElement(I.Z,{text:this.t("btnGet"),type:"success",width:"100%",onClick:this._btnGetClick})),u.createElement("div",{className:"col-3"}),u.createElement("div",{className:"col-3"}),u.createElement("div",{className:"col-3"},u.createElement(I.Z,{text:this.t("btnDispatch"),type:"default",width:"100%",onClick:function(){e._btnSave(0)}}))),u.createElement("div",{className:"row px-2 pt-2"},u.createElement("div",{className:"col-12"},u.createElement(S.ZP,{id:"grdRebateList",parent:this,selection:{mode:"multiple"},showBorders:!0,filterRow:{visible:!0},headerFilter:{visible:!0},columnAutoWidth:!0,allowColumnReordering:!0,loadPanel:{enabled:!0},allowColumnResizing:!0},u.createElement(S.Po,{defaultPageSize:20}),u.createElement(S.uE,{visible:!0,allowedPageSizes:[5,10,50],showPageSizeSelector:!0}),u.createElement(S.sg,{dataField:"ITEM_CODE",caption:this.t("grdRebateList.clmCode"),visible:!0,width:200}),u.createElement(S.sg,{dataField:"ITEM_NAME",caption:this.t("grdRebateList.clmName"),visible:!0,width:300}),u.createElement(S.sg,{dataField:"QUANTITY",caption:this.t("grdRebateList.clmQuantity"),visible:!0}),u.createElement(S.sg,{dataField:"CUSTOMER_NAME",caption:this.t("grdRebateList.clmCustomer"),visible:!0}),u.createElement(S.sg,{dataField:"CUSTOMER_PRICE",caption:this.t("grdRebateList.clmPrice"),visible:!0}))))))}}]),v}(u.PureComponent)}}]);