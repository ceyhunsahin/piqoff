"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[4095],{84095:(t,e,n)=>{n.r(e),n.d(e,{default:()=>k});var a=n(4942),i=n(15861),r=n(15671),s=n(43144),o=n(97326),l=n(60136),c=n(82963),m=n(61120),u=n(64687),d=n.n(u),E=n(67294),h=n(73364),p=n(41764),C=n(30381),f=n.n(C),g=n(42866),I=n.n(g),x=n(53221),v=n.n(x),b=n(25552),D=n.n(b),T=n(30886),w=n(99846),S=(n(5083),n(99077)),O=(n(55585),n(417)),R=n(32175),M=n(18405),P=n(73682),_=n(90428),y=n(51559),A=n(60547),U=n(17276);function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k=function(t){(0,l.Z)(V,t);var e,n,a,u,C,g,x,N,k,F=(N=V,k=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,m.Z)(N);if(k){var n=(0,m.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,c.Z)(this,t)});function V(t){var e;return(0,r.Z)(this,V),(e=F.call(this,t)).core=h.Z.instance.core,e.prmObj=e.param.filter({TYPE:1,USERS:e.user.CODE}),e.contractObj=new p.c,e.tabIndex=t.data.tabkey,e._getItems=e._getItems.bind((0,o.Z)(e)),e.multiItemData=new U.$A,e}return(0,s.Z)(V,[{key:"componentDidMount",value:(x=(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.util.waitUntil(0);case 2:this.init();case 3:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"init",value:(g=(0,i.Z)(d().mark((function t(){var e=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.contractObj.clearAll(),this.contractObj.ds.on("onAddRow",(function(t,n){"new"==n.stat&&(e.btnNew.setState({disabled:!1}),e.btnSave.setState({disabled:!1}),e.btnDelete.setState({disabled:!1}))})),this.contractObj.ds.on("onEdit",(function(t,n){"edit"==n.rowData.stat&&(e.btnNew.setState({disabled:!1}),e.btnSave.setState({disabled:!1}),e.btnDelete.setState({disabled:!1}),n.rowData.CUSER=e.user.CODE)})),this.contractObj.ds.on("onRefresh",(function(t){e.btnNew.setState({disabled:!1}),e.btnSave.setState({disabled:!0}),e.btnDelete.setState({disabled:!1})})),this.contractObj.ds.on("onDelete",(function(t){e.btnNew.setState({disabled:!1}),e.btnSave.setState({disabled:!1}),e.btnDelete.setState({disabled:!1})})),this.cmbDepot.value="",this.txtRef.value=this.user.CODE,this.txtCustomerCode.value="",this.txtCustomerName.value="",this.startDate.value=f()(new Date(0)).format("YYYY-MM-DD"),this.finishDate.value=f()(new Date(0)).format("YYYY-MM-DD"),t.next=13,this.grdContracts.dataRefresh({source:this.contractObj.dt("SALES_CONTRACT")});case 13:return t.next=15,this.grdMultiItem.dataRefresh({source:this.multiItemData});case 15:this.txtRef.props.onChange();case 16:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"_getItems",value:(C=(0,i.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={source:{select:{query:"SELECT GUID,CODE,NAME,VAT,ISNULL((SELECT TOP 1 MULTICODE FROM ITEM_MULTICODE_VW_01 WHERE ITEM_GUID = ITEMS_VW_01.GUID AND CUSTOMER_GUID = '"+this.txtCustomerCode.GUID+"'),'') AS MULTICODE FROM ITEMS_VW_01 WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(NAME) LIKE UPPER(@VAL) ",param:["VAL:string|50"]},sql:this.core.sql}},this.pg_txtPopItemsCode.setSource(e);case 2:case"end":return t.stop()}}),t,this)}))),function(){return C.apply(this,arguments)})},{key:"addItem",value:(u=(0,i.Z)(d().mark((function t(e){var n,a,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=L({},this.contractObj.empty)).CUSER=this.core.auth.data.CODE,n.CUSER_NAME=this.core.auth.data.NAME,n.REF=this.txtRef.value,n.REF_NO=this.txtRefno.value,n.TYPE=1,n.ITEM=e.GUID,n.ITEM_CODE=e.CODE,n.ITEM_NAME=e.NAME,n.CUSTOMER=this.txtCustomerCode.GUID,n.CUSTOMER_CODE=this.txtCustomerCode.value,n.CUSTOMER_NAME=this.txtCustomerName.value,n.QUANTITY=1,n.START_DATE=this.startDate.value,n.FINISH_DATE=this.finishDate.value,""!=this.cmbDepot.value&&(n.DEPOT=this.cmbDepot.value,n.DEPOT_NAME=this.cmbDepot.displayExpr),a={query:"SELECT COST_PRICE,VAT,(SELECT [dbo].[FN_PRICE_SALE](@GUID,1,GETDATE(),@CUSTOMER_GUID)) AS PRICE FROM ITEMS WHERE ITEMS.GUID = @GUID",param:["GUID:string|50","CUSTOMER_GUID:string|50","QUANTITY:float"],value:[e.GUID,this.txtCustomerCode.GUID,1]},t.next=16,this.core.sql.execute(a);case 16:(i=t.sent).result.recordset.length>0?(n.PRICE=i.result.recordset[0].PRICE,n.COST_PRICE=i.result.recordset[0].COST_PRICE,n.PRICE_VAT_EXT=i.result.recordset[0].PRICE/(i.result.recordset[0].VAT/100+1),n.VAT_RATE=i.result.recordset[0].VAT):n.PRICE=0,this.contractObj.addEmpty(n),this._calculateMargin();case 20:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"multiItemAdd",value:(a=(0,i.Z)(d().mark((function t(){var e,n,a,i,r,s,o,l,c,m;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=[],n=0,!(this.multiItemData.length>0)){t.next=8;break}return a={id:"msgMultiData",showTitle:!0,title:this.t("msgMultiData.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgMultiData.btn01"),location:"before"},{id:"btn02",caption:this.t("msgMultiData.btn02"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgMultiData.msg"))},t.next=6,(0,A.W)(a);case 6:"btn01"==t.sent&&this.multiItemData.clear();case 8:i=0;case 9:if(!(i<this.tagItemCode.value.length)){t.next=27;break}if(0!=this.cmbMultiItemType.value){t.next=18;break}return r={query:"SELECT GUID,CODE,NAME,VAT,1 AS QUANTITY,ISNULL((SELECT TOP 1 MULTICODE FROM ITEM_MULTICODE_VW_01 WHERE ITEM_GUID = ITEMS_VW_01.GUID AND CUSTOMER_GUID = '"+this.txtCustomerCode.GUID+"'),'') AS MULTICODE FROM ITEMS_VW_01 WHERE ISNULL((SELECT TOP 1 MULTICODE FROM ITEM_MULTICODE_VW_01 WHERE ITEM_GUID = ITEMS_VW_01.GUID AND CUSTOMER_GUID = '"+this.txtCustomerCode.GUID+"'),'') = @VALUE ",param:["VALUE:string|50"],value:[this.tagItemCode.value[i]]},t.next=14,this.core.sql.execute(r);case 14:(s=t.sent).result.recordset.length>0?void 0===this.multiItemData.where({CODE:s.result.recordset[0].CODE})[0]&&(this.multiItemData.push(s.result.recordset[0]),n+=1):e.push("'"+this.tagItemCode.value[i]+"'"),t.next=24;break;case 18:if(1!=this.cmbMultiItemType.value){t.next=24;break}return o={query:"SELECT GUID,CODE,NAME,VAT,1 AS QUANTITY,ISNULL((SELECT TOP 1 MULTICODE FROM ITEM_MULTICODE_VW_01 WHERE ITEM_GUID = ITEMS_VW_01.GUID AND CUSTOMER_GUID = '"+this.txtCustomerCode.GUID+"'),'') AS MULTICODE FROM ITEMS_VW_01 WHERE UPPER(CODE) LIKE UPPER(@VALUE) OR UPPER(NAME) LIKE UPPER(@VALUE) ",param:["VALUE:string|50"],value:[this.tagItemCode.value[i]]},t.next=22,this.core.sql.execute(o);case 22:(l=t.sent).result.recordset.length>0?void 0===this.multiItemData.where({CODE:l.result.recordset[0].CODE})[0]&&(this.multiItemData.push(l.result.recordset[0]),n+=1):e.push("'"+this.tagItemCode.value[i]+"'");case 24:i++,t.next=9;break;case 27:if(!(e.length>0)){t.next=31;break}return c={id:"msgMissItemCode",showTitle:!0,title:this.t("msgMissItemCode.title"),showCloseButton:!0,width:"500px",height:"auto",button:[{id:"btn01",caption:this.t("msgMissItemCode.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",wordWrap:"break-word",fontSize:"20px"}},this.t("msgMissItemCode.msg")+" "+e)},t.next=31,(0,A.W)(c);case 31:return m={id:"msgMultiCodeCount",showTitle:!0,title:this.t("msgMultiCodeCount.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgMultiCodeCount.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgMultiCodeCount.msg")+" "+n)},t.next=34,(0,A.W)(m);case 34:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"multiItemSave",value:(n=(0,i.Z)(d().mark((function t(){var e,n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=0;e<this.multiItemData.length;e++)(n=L({},this.contractObj.empty)).CUSER=this.core.auth.data.CODE,n.REF=this.txtRef.value,n.REF_NO=this.txtRefno.value,n.TYPE=1,n.ITEM=this.multiItemData[e].GUID,n.ITEM_CODE=this.multiItemData[e].CODE,n.ITEM_NAME=this.multiItemData[e].NAME,n.COST_PRICE=this.multiItemData[e].COST_PRICE,n.CUSTOMER=this.txtCustomerCode.GUID,n.CUSTOMER_CODE=this.txtCustomerCode.value,n.CUSTOMER_NAME=this.txtCustomerName.value,n.QUANTITY=this.multiItemData[e].QUANTITY,n.PRICE=this.multiItemData[e].PRICE,n.START_DATE=this.startDate.value,n.FINISH_DATE=this.finishDate.value,""!=this.cmbDepot.value&&(n.DEPOT=this.cmbDepot.value,n.DEPOT_NAME=this.cmbDepot.displayExpr),this.contractObj.addEmpty(n);this.popMultiItem.hide();case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_calculateMargin",value:(e=(0,i.Z)(d().mark((function t(){var e,n,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=0;e<this.contractObj.dt().length;e++)n=this.contractObj.dt()[e].PRICE_VAT_EXT-this.contractObj.dt()[e].COST_PRICE,a=100*n,this.contractObj.dt()[e].MARGIN=n.toFixed(2)+"€ / %"+a.toFixed(2),console.log(n.toFixed(2)+"€ / %"+a.toFixed(2)),console.log(a.toFixed(2)),console.log(this.contractObj.dt()[e].MARGIN);case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"render",value:function(){var t,e=this;return E.createElement("div",null,E.createElement(I(),null,E.createElement("div",{className:"row px-2 pt-2"},E.createElement("div",{className:"col-12"},E.createElement(v(),null,E.createElement(b.Item,{location:"after",locateInMenu:"auto"},E.createElement(P.Z,{id:"btnNew",parent:this,icon:"file",type:"default",onClick:function(){e.init()}})),E.createElement(b.Item,{location:"after",locateInMenu:"auto"},E.createElement(P.Z,{id:"btnSave",parent:this,icon:"floppy",type:"default",validationGroup:"frmPurcContract"+this.tabIndex,onClick:function(){var t=(0,i.Z)(d().mark((function t(n){var a,i,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("valid"!=n.validationGroup.validate().status){t.next=23;break}return a={id:"msgSave",showTitle:!0,title:e.t("msgSave.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgSave.btn01"),location:"before"},{id:"btn02",caption:e.t("msgSave.btn02"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgSave.msg"))},t.next=4,(0,A.W)(a);case 4:if("btn01"!=t.sent){t.next=21;break}return i={id:"msgSaveResult",showTitle:!0,title:e.t("msgSave.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgSave.btn01"),location:"after"}]},t.next=9,e.contractObj.save();case 9:if(t.t0=t.sent,0!=t.t0){t.next=18;break}return i.content=E.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"green"}},e.t("msgSaveResult.msgSuccess")),t.next=14,(0,A.W)(i);case 14:e.btnSave.setState({disabled:!0}),e.btnNew.setState({disabled:!1}),t.next=21;break;case 18:return i.content=E.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"red"}},e.t("msgSaveResult.msgFailed")),t.next=21,(0,A.W)(i);case 21:t.next=26;break;case 23:return r={id:"msgSaveValid",showTitle:!0,title:e.t("msgSaveValid.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgSaveValid.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgSaveValid.msg"))},t.next=26,(0,A.W)(r);case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})),E.createElement(b.Item,{location:"after",locateInMenu:"auto"},E.createElement(P.Z,{id:"btnDelete",parent:this,icon:"trash",type:"default",onClick:(0,i.Z)(d().mark((function t(){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:"msgDelete",showTitle:!0,title:e.t("msgDelete.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgDelete.btn01"),location:"before"},{id:"btn02",caption:e.t("msgDelete.btn02"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgDelete.msg"))},t.next=3,(0,A.W)(n);case 3:if("btn01"!=t.sent){t.next=9;break}return e.contractObj.dt().removeAt(0),t.next=8,e.contractObj.dt().delete();case 8:e.init();case 9:case"end":return t.stop()}}),t)})))})),E.createElement(b.Item,{location:"after",locateInMenu:"auto"},E.createElement(P.Z,{id:"btnPrint",parent:this,icon:"print",type:"default",onClick:function(){e.popDesign.show()}})),E.createElement(b.Item,{location:"after",locateInMenu:"auto",widget:"dxButton",options:{type:"default",icon:"clear",onClick:(t=(0,i.Z)(d().mark((function t(){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:"msgClose",showTitle:!0,title:e.lang.t("msgWarning"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.lang.t("btnYes"),location:"before"},{id:"btn02",caption:e.lang.t("btnNo"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.lang.t("msgClose"))},t.next=3,(0,A.W)(n);case 3:"btn01"==t.sent&&h.Z.instance.panel.closePage();case 5:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}})))),E.createElement("div",{className:"row px-2 pt-2"},E.createElement("div",{className:"col-12"},E.createElement(D(),{colCount:3,id:"frmHeader"},E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("txtRefRefno"),alignment:"right"}),E.createElement("div",{className:"row"},E.createElement("div",{className:"col-4 pe-0"},E.createElement(w.ZP,{id:"txtRef",parent:this,simple:!0,dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"REF"},upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,maxLength:32,onChange:function(){var t=(0,i.Z)(d().mark((function t(n){var a,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={query:"SELECT ISNULL(MAX(REF_NO) + 1,1) AS REF_NO FROM SALES_CONTRACT WHERE TYPE = 1  AND REF = @REF ",param:["REF:string|25"],value:[e.txtRef.value]},t.next=3,e.core.sql.execute(a);case 3:(i=t.sent).result.recordset.length>0&&(e.txtRefno.value=i.result.recordset[0].REF_NO);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this),param:this.param.filter({ELEMENT:"txtRef",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtRef",USERS:this.user.CODE})},E.createElement(w.cX,{validationGroup:"frmPurcContract"+this.tabIndex},E.createElement(w.n2,{message:this.t("validRef")})))),E.createElement("div",{className:"col-5 ps-0"},E.createElement(w.ZP,{id:"txtRefno",parent:this,simple:!0,dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"REF_NO"},button:[{id:"01",icon:"more",onClick:function(){e.pg_Docs.show(),e.pg_Docs.onClick=function(){var t=(0,i.Z)(d().mark((function t(n){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length>0)){t.next=5;break}return t.next=3,e.contractObj.load({REF:n[0].REF,REF_NO:n[0].REF_NO,TYPE:1});case 3:e.txtCustomerCode.GUID=e.contractObj.dt()[0].CUSTOMER,e._getItems();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},{id:"02",icon:"arrowdown",onClick:function(){e.txtRefno.value=Math.floor(Date.now()/1e3)}}],onChange:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkDoc("00000000-0000-0000-0000-000000000000",e.txtRef.value,e.txtRefno.value);case 2:3==t.sent&&(e.txtRefno.value="");case 4:case"end":return t.stop()}}),t)}))).bind(this),param:this.param.filter({ELEMENT:"txtRefno",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtRefno",USERS:this.user.CODE})},E.createElement(w.cX,{validationGroup:"frmPurcContract"+this.tabIndex},E.createElement(w.n2,{message:this.t("validRefNo")}))))),E.createElement(O.Z,{id:"pg_Docs",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("pg_Docs.title"),data:{source:{select:{query:"SELECT REF,REF_NO,CUSTOMER,CUSTOMER_CODE,CUSTOMER_NAME FROM SALES_CONTRACT_VW_01 WHERE TYPE = 1 GROUP BY REF,REF_NO,CUSTOMER,CUSTOMER_CODE,CUSTOMER_NAME"},sql:this.core.sql}},button:[{id:"01",icon:"more",onClick:function(){}}]},E.createElement(M.sg,{dataField:"REF",caption:this.t("pg_Docs.clmRef"),width:150,defaultSortOrder:"asc"}),E.createElement(M.sg,{dataField:"REF_NO",caption:this.t("pg_Docs.clmRefNo"),width:300,defaultSortOrder:"asc"}),E.createElement(M.sg,{dataField:"CUSTOMER_NAME",caption:this.t("pg_Docs.clmOutputName"),width:300,defaultSortOrder:"asc"}),E.createElement(M.sg,{dataField:"CUSTOMER_CODE",caption:this.t("pg_Docs.clmOutputCode"),width:300,defaultSortOrder:"asc"}))),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("cmbDepot"),alignment:"right"}),E.createElement(S.ZP,{simple:!0,parent:this,id:"cmbDepot",displayExpr:"NAME",valueExpr:"GUID",value:"",searchEnabled:!0,onValueChanged:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this),data:{source:{select:{query:"SELECT * FROM DEPOT_VW_01 WHERE TYPE IN (0,2) AND STATUS = 1"},sql:this.core.sql}},param:this.param.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE})})),E.createElement(b.EmptyItem,null),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("txtCustomerCode"),alignment:"right"}),E.createElement(w.ZP,{id:"txtCustomerCode",parent:this,simple:!0,dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"CUSTOMER_CODE"},upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,onEnterKey:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.pg_txtCustomerCode.setVal(e.txtCustomerCode.value);case 2:e.pg_txtCustomerCode.show(),e.pg_txtCustomerCode.onClick=function(t){t.length>0&&(e.txtCustomerCode.GUID=t[0].GUID,e.txtCustomerCode.value=t[0].CODE,e.txtCustomerName.value=t[0].TITLE,e._getItems())};case 4:case"end":return t.stop()}}),t)}))).bind(this),button:[{id:"01",icon:"more",onClick:function(){e.pg_txtCustomerCode.show(),e.pg_txtCustomerCode.onClick=function(t){t.length>0&&(e.txtCustomerCode.GUID=t[0].GUID,e.txtCustomerCode.value=t[0].CODE,e.txtCustomerName.value=t[0].TITLE,e._getItems())}}}],param:this.param.filter({ELEMENT:"txtCustomerCode",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtCustomerCode",USERS:this.user.CODE})},E.createElement(w.cX,{validationGroup:"frmPurcContract"+this.tabIndex},E.createElement(w.n2,{message:this.t("validCustomerCode")}))),E.createElement(O.Z,{id:"pg_txtCustomerCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("pg_txtCustomerCode.title"),search:!0,data:{source:{select:{query:"SELECT GUID,CODE,TITLE,NAME,LAST_NAME,[TYPE_NAME],[GENUS_NAME] FROM CUSTOMER_VW_01 WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(TITLE) LIKE UPPER(@VAL)",param:["VAL:string|50"]},sql:this.core.sql}},button:{id:"01",icon:"more",onClick:function(){console.log(1111)}}},E.createElement(M.sg,{dataField:"CODE",caption:this.t("pg_txtCustomerCode.clmCode"),width:150}),E.createElement(M.sg,{dataField:"TITLE",caption:this.t("pg_txtCustomerCode.clmTitle"),width:500,defaultSortOrder:"asc"}),E.createElement(M.sg,{dataField:"TYPE_NAME",caption:this.t("pg_txtCustomerCode.clmTypeName"),width:150}),E.createElement(M.sg,{dataField:"GENUS_NAME",caption:this.t("pg_txtCustomerCode.clmGenusName"),width:150}))),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("txtCustomerName"),alignment:"right"}),E.createElement(w.ZP,{id:"txtCustomerName",parent:this,simple:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"CUSTOMER_NAME"},readOnly:!0,param:this.param.filter({ELEMENT:"txtCustomerName",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtCustomerName",USERS:this.user.CODE})})),E.createElement(b.EmptyItem,null),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("startDate"),alignment:"right"}),E.createElement(_.ZP,{simple:!0,parent:this,id:"startDate",dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"START_DATE"},onValueChanged:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)},E.createElement(w.cX,{validationGroup:"frmPurcContract"+this.tabIndex},E.createElement(w.n2,{message:this.t("validDate")})))),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("finishDate"),alignment:"right"}),E.createElement(_.ZP,{simple:!0,parent:this,id:"finishDate",dt:{data:this.contractObj.dt("SALES_CONTRACT"),field:"FINISH_DATE"},onValueChanged:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)},E.createElement(w.cX,{validationGroup:"frmPurcContract"+this.tabIndex},E.createElement(w.n2,{message:this.t("validDate")}))))))),E.createElement("div",{className:"row px-2 pt-2"},E.createElement("div",{className:"col-12"},E.createElement(D(),{colCount:1,onInitialized:function(t){e.frmPurcContract=t.component}},E.createElement(b.Item,{location:"after"},E.createElement(T.Button,{icon:"add",validationGroup:"frmPurcContract"+this.tabIndex,onClick:function(){var t=(0,i.Z)(d().mark((function t(n){var a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("valid"!=n.validationGroup.validate().status){t.next=5;break}e.pg_txtPopItemsCode.show(),e.pg_txtPopItemsCode.onClick=function(){var t=(0,i.Z)(d().mark((function t(n){var a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!=n.length){t.next=5;break}return t.next=3,e.addItem(n[0]);case 3:t.next=22;break;case 5:if(!(n.length>1)){t.next=22;break}a=0;case 7:if(!(a<n.length)){t.next=22;break}if(0!=a){t.next=13;break}return t.next=11,e.addItem(n[a]);case 11:t.next=19;break;case 13:return e.txtRef.readOnly=!0,e.txtRefno.readOnly=!0,t.next=17,e.core.util.waitUntil(100);case 17:return t.next=19,e.addItem(n[a]);case 19:a++,t.next=7;break;case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.next=8;break;case 5:return a={id:"msgContractValid",showTitle:!0,title:e.t("msgContractValid.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgContractValid.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgContractValid.msg"))},t.next=8,(0,A.W)(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),E.createElement(T.Button,{icon:"increaseindent",text:this.lang.t("collectiveItemAdd"),validationGroup:"frmPurcContract"+this.tabIndex,onClick:function(){var t=(0,i.Z)(d().mark((function t(n){var a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("valid"!=n.validationGroup.validate().status){t.next=5;break}e.multiItemData.clear,e.popMultiItem.show(),t.next=8;break;case 5:return a={id:"msgDocValid",showTitle:!0,title:e.t("msgDocValid.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgDocValid.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgDocValid.msg"))},t.next=8,(0,A.W)(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})),E.createElement(b.Item,null,E.createElement(M.ZP,{parent:this,id:"grdContracts",showBorders:!0,columnsAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,filterRow:{visible:!0},height:"650",width:"100%",dbApply:!1,onRowUpdated:function(){var t=(0,i.Z)(d().mark((function t(n){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.component.getRowIndexByKey(n.key),n.key.PRICE_VAT_EXT=n.key.PRICE/(n.key.VAT_RATE/100+1),e._calculateMargin();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onRowRemoved:function(){var t=(0,i.Z)(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E.createElement(M.m_,{editOnKeyPress:!0,enterKeyAction:"moveFocus",enterKeyDirection:"column"}),E.createElement(M.LO,{mode:"cell",allowUpdating:!0,allowDeleting:!0}),E.createElement(M.Po,{defaultPageSize:10}),E.createElement(M.uE,{visible:!0,allowedPageSizes:[5,10,20,50,100],showPageSizeSelector:!0}),E.createElement(M.D7,{fileName:this.lang.t("menu.cnt_02_001"),enabled:!0,allowExportSelectedData:!0}),E.createElement(M.sg,{dataField:"CDATE_FORMAT",caption:this.t("grdContracts.clmCreateDate"),allowEditing:!1,width:200}),E.createElement(M.sg,{dataField:"ITEM_CODE",caption:this.t("grdContracts.clmItemCode"),width:150,allowEditing:!1}),E.createElement(M.sg,{dataField:"ITEM_NAME",caption:this.t("grdContracts.clmItemName"),width:350,allowEditing:!1}),E.createElement(M.sg,{dataField:"COST_PRICE",caption:this.t("grdContracts.clmCostPrice"),width:80,format:{style:"currency",currency:"EUR",precision:2},allowEditing:!1}),E.createElement(M.sg,{dataField:"PRICE",caption:this.t("grdContracts.clmPrice"),dataType:"number",format:{style:"currency",currency:"EUR",precision:2}}),E.createElement(M.sg,{dataField:"PRICE_VAT_EXT",caption:this.t("grdContracts.clmVatExtPrice"),dataType:"number",format:{style:"currency",currency:"EUR",precision:2},allowEditing:!1}),E.createElement(M.sg,{dataField:"QUANTITY",caption:this.t("grdContracts.clmQuantity"),dataType:"number"}),E.createElement(M.sg,{dataField:"MARGIN",caption:this.t("grdContracts.clmMargin"),allowEditing:!1}),E.createElement(M.sg,{dataField:"START_DATE",caption:this.t("grdContracts.clmStartDate"),dataType:"date",editorOptions:{value:null},cellRender:function(t){if("1970-01-01"!=f()(t.value).format("YYYY-MM-DD"))return t.text}}),E.createElement(M.sg,{dataField:"FINISH_DATE",caption:this.t("grdContracts.clmFinishDate"),dataType:"date",editorOptions:{value:null},cellRender:function(t){if("1970-01-01"!=f()(t.value).format("YYYY-MM-DD"))return t.text}}),E.createElement(M.sg,{dataField:"DEPOT_NAME",caption:this.t("grdContracts.clmDepotName"),allowEditing:!1})))))),E.createElement("div",null,E.createElement(R.ZP,{parent:this,id:"popItems",visible:!1,showCloseButton:!0,showTitle:!0,title:this.t("popItems.title"),container:"#root",width:"500",height:"450",position:{of:"#root"}},E.createElement(D(),{colCount:1,height:"fit-content"},E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.txtPopItemsCode"),alignment:"right"}),E.createElement(w.ZP,{id:"txtPopItemsCode",parent:this,simple:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,onEnterKey:(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.pg_txtPopItemsCode.setVal(e.txtPopItemsCode.value);case 2:e.pg_txtPopItemsCode.show(),e.pg_txtPopItemsCode.onClick=function(t){t.length>0&&(e.txtPopItemsCode.GUID=t[0].GUID,e.txtPopItemsCode.value=t[0].CODE,e.txtPopItemsName.value=t[0].NAME)};case 4:case"end":return t.stop()}}),t)}))).bind(this),button:[{id:"01",icon:"more",onClick:function(){e.pg_txtPopItemsCode.show(),e.pg_txtPopItemsCode.onClick=function(t){t.length>0&&(e.txtPopItemsCode.GUID=t[0].GUID,e.txtPopItemsCode.value=t[0].CODE,e.txtPopItemsName.value=t[0].NAME)}}}]},E.createElement(w.cX,{validationGroup:"frmPurcContItems"+this.tabIndex},E.createElement(w.n2,{message:this.t("validItemsCode")})))),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.txtPopItemsName"),alignment:"right"}),E.createElement(w.ZP,{id:"txtPopItemsName",parent:this,simple:!0,editable:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value})),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.txtPopItemsPrice"),alignment:"right"}),E.createElement(w.ZP,{id:"txtPopItemsPrice",parent:this,simple:!0},E.createElement(w.cX,{validationGroup:this.tabIndex},E.createElement(w.n2,{message:this.t("validItemPrice")})))),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.txtPopItemsQuantity"),alignment:"right"}),E.createElement(w.ZP,{id:"txtPopItemsQuantity",parent:this,simple:!0})),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.dtPopStartDate"),alignment:"right"}),E.createElement(_.ZP,{simple:!0,parent:this,id:"dtPopStartDate"})),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("popItems.dtPopEndDate"),alignment:"right"}),E.createElement(_.ZP,{simple:!0,parent:this,id:"dtPopEndDate"})),E.createElement(b.Item,null,E.createElement("div",{className:"row"},E.createElement("div",{className:"col-6"},E.createElement(P.Z,{text:this.lang.t("btnSave"),type:"normal",stylingMode:"contained",width:"100%",validationGroup:"frmPurcContItems"+this.tabIndex,onClick:function(){var t=(0,i.Z)(d().mark((function t(n){var a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("valid"!=n.validationGroup.validate().status){t.next=6;break}return t.next=3,e.addItem();case 3:e.popItems.hide(),t.next=9;break;case 6:return a={id:"msgSaveValid",showTitle:!0,title:e.t("msgSaveValid.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.t("msgSaveValid.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.t("msgSaveValid.msg"))},t.next=9,(0,A.W)(a);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})),E.createElement("div",{className:"col-6"},E.createElement(P.Z,{text:this.lang.t("btnCancel"),type:"normal",stylingMode:"contained",width:"100%",onClick:function(){e.popItems.hide()}}))))))),E.createElement(O.Z,{id:"pg_txtPopItemsCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("pg_txtPopItemsCode.title"),search:!0},E.createElement(M.Po,{defaultPageSize:22}),E.createElement(M.sg,{dataField:"CODE",caption:this.t("pg_txtPopItemsCode.clmCode"),width:150}),E.createElement(M.sg,{dataField:"NAME",caption:this.t("pg_txtPopItemsCode.clmName"),width:300,defaultSortOrder:"asc"}))),E.createElement("div",null,E.createElement(R.ZP,{parent:this,id:"popMultiItem",visible:!1,showCloseButton:!0,showTitle:!0,title:this.t("popMultiItem.title"),container:"#root",width:"900",height:"700",position:{of:"#root"}},E.createElement(D(),{colCount:2,height:"fit-content"},E.createElement(b.Item,{colSpan:2},E.createElement(b.Label,{alignment:"right"}),E.createElement(y.ZP,{id:"tagItemCode",parent:this,simple:!0,value:[],placeholder:this.t("tagItemCodePlaceholder")})),E.createElement(b.EmptyItem,null),E.createElement(b.Item,null,E.createElement(b.Label,{text:this.t("cmbMultiItemType.title"),alignment:"right"}),E.createElement(S.ZP,{simple:!0,parent:this,id:"cmbMultiItemType",height:"fit-content",displayExpr:"VALUE",valueExpr:"ID",value:0,data:{source:[{ID:0,VALUE:this.t("cmbMultiItemType.customerCode")},{ID:1,VALUE:this.t("cmbMultiItemType.ItemCode")}]}})),E.createElement(b.EmptyItem,null),E.createElement(b.Item,null,E.createElement("div",{className:"row"},E.createElement("div",{className:"col-6"},E.createElement(P.Z,{text:this.t("popMultiItem.btnApprove"),type:"normal",stylingMode:"contained",width:"100%",onClick:function(){var t=(0,i.Z)(d().mark((function t(n){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.multiItemAdd();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})),E.createElement("div",{className:"col-6"},E.createElement(P.Z,{text:this.t("popMultiItem.btnClear"),type:"normal",stylingMode:"contained",width:"100%",onClick:function(){e.multiItemData.clear()}})))),E.createElement(b.Item,{colSpan:2},E.createElement(M.ZP,{parent:this,id:"grdMultiItem",showBorders:!0,columnsAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,headerFilter:{visible:!0},filterRow:{visible:!0},height:400,width:"100%",dbApply:!1,onRowRemoved:function(){var t=(0,i.Z)(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E.createElement(M.m_,{editOnKeyPress:!0,enterKeyAction:"moveFocus",enterKeyDirection:"column"}),E.createElement(M.PY,{mode:"standart"}),E.createElement(M.LO,{mode:"cell",allowUpdating:!0,allowDeleting:!0}),E.createElement(M.sg,{dataField:"CODE",caption:this.t("grdMultiItem.clmCode"),width:150,allowEditing:!1}),E.createElement(M.sg,{dataField:"MULTICODE",caption:this.t("grdMultiItem.clmMulticode"),width:150,allowEditing:!1}),E.createElement(M.sg,{dataField:"NAME",caption:this.t("grdMultiItem.clmName"),width:300,headerFilter:{visible:!0},allowEditing:!1}),E.createElement(M.sg,{dataField:"QUANTITY",caption:this.t("grdMultiItem.clmQuantity"),dataType:"number",width:100,headerFilter:{visible:!0}}),E.createElement(M.sg,{dataField:"PRICE",caption:this.t("grdMultiItem.clmPrice"),dataType:"number",width:100,headerFilter:{visible:!0}}))),E.createElement(b.EmptyItem,null),E.createElement(b.Item,null,E.createElement("div",{className:"row"},E.createElement("div",{className:"col-6"}),E.createElement("div",{className:"col-6"},E.createElement(P.Z,{text:this.t("popMultiItem.btnSave"),type:"normal",stylingMode:"contained",width:"100%",onClick:function(){e.multiItemSave()}}))))))))}}]),V}(E.PureComponent)}}]);