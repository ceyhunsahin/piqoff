"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[599],{90599:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P});var n=r(15861),a=r(15671),s=r(43144),i=r(97326),c=r(60136),o=r(82963),u=r(61120),l=r(64687),d=r.n(l),E=r(67294),p=r(95403),D=r(18405),h=r(25552),f=r.n(h),m=(r(99077),r(4942)),S=r(17276);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,m.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r(30381);var g=function(){function e(){(0,a.Z)(this,e),this.core=S.vE.instance,this.ds=new S.gx,this.empty={GUID:"00000000-0000-0000-0000-000000000000",CUSER:null==this.core.auth.data?"":this.core.auth.data.CODE,CODE:"",NAME:"",PWD:"",ROLE:"",SHA:"",CARDID:"",STATUS:0},this._initDs()}return(0,s.Z)(e,[{key:"_initDs",value:function(){var e=new S.$A("USERS");e.selectCmd={query:"SELECT * FROM USERS WHERE ((GUID = @GUID) OR (@GUID = '00000000-0000-0000-0000-000000000000'))",param:["GUID:string|50"]},e.insertCmd={query:"EXEC [dbo].[PRD_USERS_INSERT] @GUID = @PGUID, @CODE = @PCODE, @NAME = @PNAME, @LAST_NAME = @PLAST_NAME, @PWD = @PPWD, @ROLE = @PROLE, @CARDID = @CARDID, @SHA = @PSHA, @STATUS = @PSTATUS ",param:["PGUID:string|50","PCODE:string|25","PNAME:string|50","PLAST_NAME:string|50","PPWD:string|50","PROLE:string|25","CARDID:string|25","PSHA:string|200","PSTATUS:bit"],dataprm:["GUID","CODE","NAME","LAST_NAME","PWD","ROLE","CARDID","SHA","STATUS"]},e.updateCmd={query:"EXEC [dbo].[PRD_USERS_UPDATE] @GUID = @PGUID, @CODE = @PCODE, @NAME = @PNAME, @LAST_NAME = @PLAST_NAME, @PWD = @PPWD, @ROLE = @PROLE, @CARDID = @CARDID, @SHA = @PSHA, @STATUS = @PSTATUS ",param:["PGUID:string|50","PCODE:string|25","PNAME:string|50","PLAST_NAME:string|50","PPWD:string|50","PROLE:string|25","CARDID:string|25","PSHA:string|200","PSTATUS:bit"],dataprm:["GUID","CODE","NAME","LAST_NAME","PWD","ROLE","CARDID","SHA","STATUS"]},this.ds.add(e)}},{key:"dt",value:function(){return arguments.length>0?this.ds.get(arguments[0]):this.ds.get(0)}},{key:"addEmpty",value:function(){if(void 0!==this.dt("USERS")){var e={};(e=O({},arguments.length>0?arguments[0]:this.empty)).GUID=S.$A.uuidv4(),this.dt("USERS").push(e)}}},{key:"clearAll",value:function(){for(var e=0;e<this.ds.length;e++)this.dt(e).clear()}},{key:"load",value:function(){var e=arguments,t=this;return new Promise(function(){var r=(0,n.Z)(d().mark((function r(n){var a;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={GUID:"00000000-0000-0000-0000-000000000000"},e.length>0&&(a.GUID=void 0===e[0].GUID?"00000000-0000-0000-0000-000000000000":e[0].GUID),t.ds.get("USERS").selectCmd.value=Object.values(a),r.next=5,t.ds.get("USERS").refresh();case 5:n(t.ds.get("USERS"));case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"save",value:function(){var e=this;return new Promise(function(){var t=(0,n.Z)(d().mark((function t(r){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ds.delete(),t.t0=r,t.next=4,e.ds.update();case 4:t.t1=t.sent,(0,t.t0)(t.t1);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),e}();var P=function(e){(0,c.Z)(S,e);var t,r,l,m=(r=S,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,u.Z)(r);if(l){var n=(0,u.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,o.Z)(this,e)});function S(e){var t;return(0,a.Z)(this,S),(t=m.call(this,e)).core=p.Z.instance.core,t.userObj=new g,t.RoleCmb=[{CODE:"Administrator",NAME:"Administrator"},{CODE:"User",NAME:"User"},{CODE:"Pos",NAME:"Pos"}],t._cellRoleRender=t._cellRoleRender.bind((0,i.Z)(t)),t}return(0,s.Z)(S,[{key:"_cellRoleRender",value:function(e){}},{key:"init",value:(t=(0,n.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userObj.load();case 2:return e.next=4,this.grdUserList.dataRefresh({source:this.userObj.dt("USERS")});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var e=this;return E.createElement("div",{className:"row p-2"},E.createElement("div",{className:"col-12"},E.createElement(D.ZP,{id:"grdUserList",parent:this,onSelectionChanged:this.onSelectionChanged,showBorders:!0,allowColumnResizing:!0,selection:{mode:"single"},width:"100%",height:"100%",data:this.data,dbApply:!1,filterRow:{visible:!0},headerFilter:{visible:!0},param:this.param.filter({ELEMENT:"grdUserList",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"grdUserList",USERS:this.user.CODE}),onRowUpdating:function(){var e=(0,n.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==t.newData.PWD&&(t.newData.PWD=btoa(t.newData.PWD));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onRowPrepared:function(){var e=(0,n.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onRowUpdated:function(){var t=(0,n.Z)(d().mark((function t(r){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.userObj.save();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onRowInserted:function(){var t=(0,n.Z)(d().mark((function t(r){var n,a,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=e.userObj.dt().where({CODE:r.data.CODE})).length>0)){t.next=12;break}return e.userObj.dt()[e.userObj.dt().length-1].PWD=btoa(n[0].PWD),t.next=5,e.userObj.save();case 5:return a={query:"SELECT GUID,CODE FROM USERS WHERE CODE = @CODE ",param:["CODE:string|50"],value:[r.data.CODE]},t.next=8,e.core.sql.execute(a);case 8:if(!((s=t.sent).result.recordset.length>0)){t.next=12;break}return t.next=12,e.core.auth.refreshToken(s.result.recordset[0].GUID);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E.createElement(D.LO,{mode:"popup",allowUpdating:!0,allowAdding:!0,allowDeleting:!1},E.createElement(D.GI,{title:this.t("UserEdit"),showTitle:!0,width:700,height:525}),E.createElement(f(),null,E.createElement(h.Item,{itemType:"group",colCount:2},E.createElement(h.Item,{dataField:"CODE"}),E.createElement(h.Item,{dataField:"NAME"}),E.createElement(h.Item,{dataField:"LAST_NAME"}),E.createElement(h.Item,{dataField:"PWD"}),E.createElement(h.Item,{dataField:"ROLE"}),E.createElement(h.Item,{dataField:"SHA"}),E.createElement(h.Item,{dataField:"STATUS",editorType:"boolean"})))),E.createElement(D.sg,{dataField:"CODE",caption:this.t("grdUserList.clmCode")}),E.createElement(D.sg,{dataField:"NAME",caption:this.t("grdUserList.clmName")}),E.createElement(D.sg,{dataField:"LAST_NAME",caption:this.t("grdUserList.clmLastName")}),E.createElement(D.sg,{dataField:"PWD",editorOptions:{mode:"password"},caption:this.t("grdUserList.clmPwd"),visible:!1}),E.createElement(D.sg,{dataField:"CARDID",caption:this.t("grdUserList.clmCardId")}),E.createElement(D.sg,{dataField:"ROLE",caption:this.t("grdUserList.clmRole")},E.createElement(D.tY,{dataSource:this.RoleCmb,valueExpr:"CODE",displayExpr:"CODE"})," "),E.createElement(D.sg,{dataField:"STATUS",caption:this.t("grdUserList.clmStatus"),dataType:"boolean"}))))}}]),S}(E.Component)}}]);