"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[734],{50734:(t,e,n)=>{n.r(e),n.d(e,{default:()=>B});var r=n(4942),a=n(15861),i=n(15671),o=n(43144),c=n(97326),s=n(60136),u=n(82963),l=n(61120),d=n(64687),p=n.n(d),E=n(67294),h=n(85107),m=n(28996),b=n(30381),f=n.n(b),x=n(42866),v=n.n(x),D=(n(53221),n(25552)),g=n.n(D),C=n(41226),I=n.n(C),O=(n(91686),n(30886),n(99846)),w=(n(5083),n(99077),n(55585),n(417)),R=(n(32175),n(18405)),A=n(73682),S=n(90428),y=(n(57941),n(60547));function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n(17276);var B=function(t){(0,s.Z)(B,t);var e,n,r,d,b,x,C,T=(x=B,C=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,l.Z)(x);if(C){var n=(0,l.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,u.Z)(this,t)});function B(){var t;return(0,i.Z)(this,B),(t=T.call(this)).state={tbMain:"visible",tbBarcode:"hidden",tbDocument:"hidden"},t.barcode={name:"",barcode:"",code:"",guid:"00000000-0000-0000-0000-000000000000"},t.core=h.Z.instance.core,t.prmObj=t.param.filter({TYPE:1,USERS:t.user.CODE}),t.acsobj=t.access.filter({TYPE:1,USERS:t.user.CODE}),t.barcodeScan=t.barcodeScan.bind((0,c.Z)(t)),t.barcodeReset=t.barcodeReset.bind((0,c.Z)(t)),t.dropmenuClick=t.dropmenuClick.bind((0,c.Z)(t)),t.dropmenuMainItems=[t.t("btnNew"),t.t("btnSave")],t.expObj=new m.xo,t}return(0,o.Z)(B,[{key:"componentDidMount",value:(b=(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.util.waitUntil(0);case 2:this.init();case 3:case"end":return t.stop()}}),t,this)}))),function(){return b.apply(this,arguments)})},{key:"init",value:(d=(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.expObj.clearAll(),this.barcodeReset(),this.dtlastDate.value=f()(new Date).format("DD/MM/YYYY HH:mm:ss"),t.next=5,this.grdExpDate.dataRefresh({source:this.expObj.dt("ITEM_EXPDATE")});case 5:this.setState({tbBarcode:"visible"});case 6:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"barcodeScan",value:(r=(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:cordova.plugins.barcodeScanner.scan(function(){var t=(0,a.Z)(p().mark((function t(e){var n,r,a;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=e.cancelled){t.next=22;break}return this.txtBarcode.value=e.text,n={query:"SELECT ITEM_CODE AS CODE,ITEM_NAME AS NAME,ITEM_GUID AS GUID,BARCODE FROM ITEM_BARCODE_VW_01  WHERE BARCODE = @BARCODE OR ITEM_CODE = @BARCODE ",param:["BARCODE:string|50"],value:[e.text]},t.next=5,this.core.sql.execute(n);case 5:if(!((r=t.sent).result.recordset.length>0)){t.next=17;break}this.txtBarcode.value=r.result.recordset[0].CODE,this.barcode.name=r.result.recordset[0].NAME,this.barcode.barcode=r.result.recordset[0].BARCODE,this.barcode.code=r.result.recordset[0].CODE,this.barcode.guid=r.result.recordset[0].GUID,this.txtBarcode.value="",this.txtPopQuantity.focus(),this.setState({tbBarcode:"visible"}),t.next=22;break;case 17:return document.getElementById("Sound").play(),a={id:"msgBarcodeNotFound",showTitle:!0,title:this.t("msgBarcodeNotFound.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgBarcodeNotFound.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgBarcodeNotFound.msg"))},t.next=21,(0,y.W)(a);case 21:this.txtBarcode.value="";case 22:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}().bind(this),(function(t){}),{prompt:"Scan",orientation:"portrait"});case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"addItem",value:(n=(0,a.Z)(p().mark((function t(){var e,n,r,a;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=this.barcode.code){t.next=2;break}return t.abrupt("return");case 2:if(0!=this.txtPopQuantity.value){t.next=8;break}return e={id:"msgZeroQuantity",showTitle:!0,title:this.t("msgZeroQuantity.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgZeroQuantity.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgZeroQuantity.msg"))},t.next=6,(0,y.W)(e);case 6:return this.txtPopQuantity.focus(),t.abrupt("return");case 8:n=0;case 9:if(!(n<this.expObj.dt().length)){t.next=24;break}if(this.expObj.dt()[n].ITEM_CODE!=this.barcode.code){t.next=21;break}return r={id:"msgCombineItem",showTitle:!0,title:this.t("msgCombineItem.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgCombineItem.btn01"),location:"before"},{id:"btn02",caption:this.t("msgCombineItem.btn02"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgCombineItem.msg"))},t.next=14,(0,y.W)(r);case 14:if("btn01"!=t.sent){t.next=20;break}return this.barcodeReset(),t.abrupt("return");case 20:return t.abrupt("break",24);case 21:n++,t.next=9;break;case 24:return(a=M({},this.expObj.empty)).ITEM_GUID=this.barcode.guid,a.ITEM_CODE=this.barcode.code,a.ITEM_NAME=this.barcode.name,a.QUANTITY=this.txtPopQuantity.value,a.EXP_DATE=this.dtlastDate.value,this.expObj.addEmpty(a),this.barcodeReset(),t.next=34,this.expObj.save();case 34:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"dropmenuClick",value:(e=(0,a.Z)(p().mark((function t(e){var n,r;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.itemData!=this.t("btnNew")){t.next=4;break}this.init(),t.next=23;break;case 4:if(e.itemData!=this.t("btnSave")){t.next=23;break}return n={id:"msgSave",showTitle:!0,title:this.t("msgSave.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgSave.btn01"),location:"before"},{id:"btn02",caption:this.t("msgSave.btn02"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgSave.msg"))},t.next=8,(0,y.W)(n);case 8:if("btn01"!=t.sent){t.next=23;break}return r={id:"msgSaveResult",showTitle:!0,title:this.t("msgSave.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgSave.btn01"),location:"after"}]},t.next=13,this.expObj.save();case 13:if(t.t0=t.sent,0!=t.t0){t.next=20;break}return r.content=E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgSaveResult.msgSuccess")),t.next=18,(0,y.W)(r);case 18:t.next=23;break;case 20:return r.content=E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgSaveResult.msgFailed")),t.next=23,(0,y.W)(r);case 23:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"barcodeReset",value:function(){this.barcode={name:"",barcode:"",code:"",guid:"00000000-0000-0000-0000-000000000000"},this.txtPopQuantity.value=1,this.dtlastDate.value=f()(new Date).format("DD/MM/YYYY HH:mm:ss"),this.txtBarcode.focus()}},{key:"render",value:function(){var t,e,n=this;return E.createElement(v(),null,E.createElement("div",{className:"row px-2 pt-2"},E.createElement(g(),{colCount:1},E.createElement(D.Item,null,E.createElement("div",{className:"row"},E.createElement("div",{className:"col-8"}),E.createElement("div",{className:"col-4"},E.createElement(I(),{text:this.t("btnDropmenu"),icon:"menu",items:this.dropmenuMainItems,onItemClick:this.dropmenuClick})))),E.createElement(D.Item,null,E.createElement("div",{className:"col-12 px-2 pt-2"},E.createElement(O.ZP,{id:"txtBarcode",parent:this,placeholder:this.t("txtBarcodePlace"),button:[{id:"01",icon:"more",onClick:(e=(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.popItemCode.show(),n.popItemCode.onClick=function(){var t=(0,a.Z)(p().mark((function t(e){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:1==e.length&&(n.txtBarcode.value=e[0].CODE,n.barcode.name=e[0].NAME,n.barcode.barcode=e[0].BARCODE,n.barcode.code=e[0].CODE,n.barcode.guid=e[0].GUID,n.txtBarcode.value="",n.txtPopQuantity.focus(),n.setState({tbBarcode:"visible"}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 2:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})},{id:"02",icon:"photo",onClick:(t=(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.barcodeScan();case 1:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}],onEnterKey:function(){var t=(0,a.Z)(p().mark((function t(e){var r,a,i;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.component._changedValue){t.next=2;break}return t.abrupt("return");case 2:return r={query:"SELECT ITEM_CODE AS CODE,ITEM_NAME AS NAME,ITEM_GUID AS GUID,BARCODE FROM ITEM_BARCODE_VW_01  WHERE BARCODE = @BARCODE OR ITEM_CODE = @BARCODE ",param:["BARCODE:string|50"],value:[e.component._changedValue]},t.next=5,n.core.sql.execute(r);case 5:if(!((a=t.sent).result.recordset.length>0)){t.next=17;break}n.txtBarcode.value=a.result.recordset[0].CODE,n.barcode.name=a.result.recordset[0].NAME,n.barcode.barcode=a.result.recordset[0].BARCODE,n.barcode.code=a.result.recordset[0].CODE,n.barcode.guid=a.result.recordset[0].GUID,n.txtBarcode.value="",n.txtPopQuantity.focus(),n.setState({tbBarcode:"visible"}),t.next=22;break;case 17:return document.getElementById("Sound").play(),i={id:"msgBarcodeNotFound",showTitle:!0,title:n.t("msgBarcodeNotFound.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:n.t("msgBarcodeNotFound.btn01"),location:"after"}],content:E.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},n.t("msgBarcodeNotFound.msg"))},t.next=21,(0,y.W)(i);case 21:n.txtBarcode.value="";case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)}))),E.createElement(D.Item,null,E.createElement("div",null,E.createElement("h4",{className:"text-center"},this.barcode.name))),E.createElement(D.Item,null,E.createElement(D.Label,{text:this.t("txtQuantity"),alignment:"right"}),E.createElement(O.ZP,{id:"txtPopQuantity",parent:this,simple:!0,onEnterKey:function(){var t=(0,a.Z)(p().mark((function t(e){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.addItem();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)})),E.createElement(D.Item,null,E.createElement(D.Label,{text:this.t("dtlastDate"),alignment:"right"}),E.createElement(S.ZP,{simple:!0,parent:this,id:"dtlastDate",onValueChanged:(0,a.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)})),E.createElement(D.Item,null,E.createElement("div",{className:"row"},E.createElement("div",{className:"col-12 px-4 pt-4"},E.createElement(A.Z,{text:this.t("btnItemAdd"),type:"default",width:"100%",onClick:function(){return n.addItem()}})))),E.createElement(D.Item,null,E.createElement(R.ZP,{parent:this,id:"grdExpDate",showBorders:!0,columnsAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,height:"400",width:"100%",dbApply:!1,onRowUpdated:function(){var t=(0,a.Z)(p().mark((function t(e){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onRowRemoved:function(){var t=(0,a.Z)(p().mark((function t(e){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.expObj.save();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E.createElement(R.PY,{mode:"standart"}),E.createElement(R.LO,{mode:"cell",allowUpdating:!0,allowDeleting:!0,confirmDelete:!1}),E.createElement(R.sg,{dataField:"ITEM_NAME",caption:this.t("grdExpDate.clmName"),width:250}),E.createElement(R.sg,{dataField:"EXP_DATE",caption:this.t("grdExpDate.clmDate"),width:250}),E.createElement(R.sg,{dataField:"ITEM_CODE",caption:this.t("grdExpDate.clmCode"),width:150})))),E.createElement(w.Z,{id:"popItemCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",selection:{mode:"single"},title:this.t("popItemCode.title"),search:!0,data:{source:{select:{query:"SELECT  *,  CASE WHEN UNDER_UNIT_VALUE =0  THEN 0 ELSE ROUND((PRICE * UNDER_UNIT_VALUE),2) END AS UNDER_UNIT_PRICE FROM  (  SELECT GUID,   CODE,   NAME,   ISNULL((SELECT TOP 1 BARCODE FROM ITEM_BARCODE WHERE ITEM = ITEMS_VW_01.GUID ORDER BY CDATE DESC),'') AS BARCODE,   MAIN_GRP AS ITEM_GRP,   MAIN_GRP_NAME AS ITEM_GRP_NAME,   (SELECT [dbo].[FN_PRICE_SALE](GUID,1,GETDATE()),'00000000-0000-0000-0000-000000000000') AS PRICE  , ISNULL((SELECT TOP 1 FACTOR FROM ITEM_UNIT WHERE TYPE = 1 AND ITEM_UNIT.ITEM = ITEMS_VW_01.GUID),0) AS UNDER_UNIT_VALUE FROM ITEMS_VW_01 WHERE ISNULL((SELECT TOP 1 BARCODE FROM ITEM_BARCODE WHERE ITEM = ITEMS_VW_01.GUID),'') <> '') AS TMP WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(NAME) LIKE UPPER(@VAL) ",param:["VAL:string|50"]},sql:this.core.sql}}},E.createElement(R.sg,{dataField:"CODE",caption:this.t("popItemCode.clmCode"),width:100}),E.createElement(R.sg,{dataField:"NAME",caption:this.t("popItemCode.clmName"),defaultSortOrder:"asc"}))))}}]),B}(E.Component)}}]);