"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[1967],{57812:(t,e,r)=>{r.d(e,{VV:()=>D,XR:()=>E});var n=r(71002),i=r(93433),s=r(15861),a=r(4942),o=r(15671),u=r(43144),c=r(64687),l=r.n(c),p=r(17276),d=r(30381),P=r.n(d);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){(0,a.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var E=function(){function t(){(0,o.Z)(this,t),this.core=p.vE.instance,this.ds=new p.gx,this.empty={GUID:"00000000-0000-0000-0000-000000000000",CUSER:this.core.auth.data.CODE,LUSER:this.core.auth.data.CODE,TAG:"",POS_GUID:"00000000-0000-0000-0000-000000000000",LINE_GUID:"00000000-0000-0000-0000-000000000000",DATA:"",DESCRIPTION:""},this._initDs()}return(0,u.Z)(t,[{key:"_initDs",value:function(){var t=new p.$A("POS_EXTRA");t.selectCmd={query:"SELECT * FROM [dbo].[POS_EXTRA_VW_01] WHERE ((GUID = @GUID) OR (@GUID = '00000000-0000-0000-0000-000000000000')) AND ((POS_GUID = @POS_GUID) OR (@POS_GUID = '00000000-0000-0000-0000-000000000000'))",param:["GUID:string|50","POS_GUID:string|50"],local:{type:"select",from:"POS_EXTRA_VW_01"}},t.insertCmd={query:"EXEC [dbo].[PRD_POS_EXTRA_INSERT] @GUID = @PGUID, @CUSER = @PCUSER, @TAG = @PTAG, @POS_GUID = @PPOS_GUID, @LINE_GUID = @PLINE_GUID, @DATA =@PDATA, @DESCRIPTION = @PDESCRIPTION ",param:["PGUID:string|50","PCUSER:string|25","PTAG:string|25","PPOS_GUID:string|50","PLINE_GUID:string|50","PDATA:string|50","PDESCRIPTION:string|max"],dataprm:["GUID","CUSER","TAG","POS_GUID","LINE_GUID","DATA","DESCRIPTION"],local:{type:"insert",into:"POS_EXTRA_VW_01",values:[{GUID:{map:"GUID"},CUSER:{map:"CUSER"},TAG:{map:"TAG"},POS_GUID:{map:"POS_GUID"},LINE_GUID:{map:"LINE_GUID"},DATA:{map:"DATA"},DESCRIPTION:{map:"DESCRIPTION"}}]}},t.updateCmd={query:"EXEC [dbo].[PRD_POS_EXTRA_UPDATE] @GUID = @PGUID, @CUSER = @PCUSER, @TAG = @PTAG, @POS_GUID = @PPOS_GUID, @LINE_GUID = @PLINE_GUID, @DATA =@PDATA, @DESCRIPTION = @PDESCRIPTION ",param:["PGUID:string|50","PCUSER:string|25","PTAG:string|25","PPOS_GUID:string|50","PLINE_GUID:string|50","PDATA:string|50","PDESCRIPTION:string|max"],dataprm:["GUID","CUSER","TAG","POS_GUID","LINE_GUID","DATA","DESCRIPTION"],local:{type:"update",in:"POS_EXTRA_VW_01",set:{CUSER:{map:"CUSER"},TAG:{map:"TAG"},POS_GUID:{map:"POS_GUID"},LINE_GUID:{map:"LINE_GUID"},DATA:{map:"DATA"},DESCRIPTION:{map:"DESCRIPTION"}},where:{GUID:{map:"GUID"}}}},t.deleteCmd={query:"EXEC [dbo].[PRD_POS_EXTRA_DELETE] @CUSER = @PCUSER, @UPDATE = 1, @GUID = @PGUID ",param:["PCUSER:string|25","PGUID:string|50"],dataprm:["CUSER","GUID"],local:{type:"delete",from:"POS_EXTRA_VW_01",where:{CUSER:{map:"CUSER"},GUID:{map:"GUID"}}}},this.ds.add(t)}},{key:"dt",value:function(){return arguments.length>0?this.ds.get(arguments[0]):this.ds.get(0)}},{key:"addEmpty",value:function(){if(void 0!==this.dt("POS_EXTRA")){var t={};(t=f({},arguments.length>0?arguments[0]:this.empty)).GUID=p.$A.uuidv4(),this.dt("POS_EXTRA").push(t)}}},{key:"clearAll",value:function(){for(var t=0;t<this.ds.length;t++)this.dt(t).clear()}},{key:"load",value:function(){var t=arguments,e=this;return new Promise(function(){var r=(0,s.Z)(l().mark((function r(n){var i;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={GUID:"00000000-0000-0000-0000-000000000000",POS_GUID:"00000000-0000-0000-0000-000000000000"},t.length>0&&(i.GUID=void 0===t[0].GUID?"00000000-0000-0000-0000-000000000000":t[0].GUID,i.POS_GUID=void 0===t[0].POS_GUID?"00000000-0000-0000-0000-000000000000":t[0].POS_GUID),e.ds.get("POS_EXTRA").selectCmd.value=Object.values(i),Object.keys(i).forEach((function(t){void 0!==i[t]&&"00000000-0000-0000-0000-000000000000"!=i[t]&&""!=i[t]&&-1!=i[t]||delete i[t]})),e.ds.get("POS_EXTRA").selectCmd.local.where=0==Object.keys(i).length?void 0:i,r.next=7,e.ds.get("POS_EXTRA").refresh();case 7:n(e.ds.get("POS_EXTRA"));case 8:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"save",value:function(){var t=this;return new Promise(function(){var e=(0,s.Z)(l().mark((function e(r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ds.delete(),e.t0=r,e.next=4,t.ds.update();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]),t}(),D=function(){function t(){(0,o.Z)(this,t),p.vE.instance.util.isElectron()&&(this.escpos=r.g.require("escpos"),this.escpos.Serial=r.g.require("escpos-serialport"),this.escpos.Screen=r.g.require("escpos-screen"),this.escpos.USB=r.g.require("escpos-usb"),this.path=r.g.require("path"),this.serialport=r.g.require("serialport")),this.core=p.vE.instance,this.ds=new p.gx,this.empty={GUID:"00000000-0000-0000-0000-000000000000",CDATE:P()(new Date).format("YYYY-MM-DD"),CUSER:this.core.auth.data.CODE,CUSER_NAME:"",LDATE:P()(new Date).format("YYYY-MM-DD"),LUSER:this.core.auth.data.CODE,LUSER_NAME:"",CODE:"",NAME:"",LCD_PORT:"",SCALE_PORT:"",PAY_CARD_PORT:"",PRINT_DESING:""},this.listeners=Object(),this.payPort=null,this.scannerPort=null,this._initDs()}var e;return(0,u.Z)(t,[{key:"on",value:function(t,e){this.listeners.hasOwnProperty(t)||(this.listeners[t]=Array()),this.listeners[t].push(e)}},{key:"emit",value:function(t,e){if(t in this.listeners){var r=this.listeners[t];for(var n in r)r[n](e)}}},{key:"_initDs",value:function(){var t=new p.$A("POS_DEVICE");t.selectCmd={query:"SELECT * FROM [dbo].[POS_DEVICE_VW_01] WHERE ((GUID = @GUID) OR (@GUID = '00000000-0000-0000-0000-000000000000')) AND ((CODE = @CODE) OR (@CODE = ''))",param:["GUID:string|50","CODE:string|25"],local:{type:"select",from:"POS_DEVICE_VW_01"}},t.insertCmd={query:"EXEC [dbo].[PRD_POS_DEVICE_INSERT] @GUID = @PGUID, @CUSER = @PCUSER, @CODE = @PCODE, @NAME = @PNAME, @LCD_PORT = @PLCD_PORT, @SCALE_PORT = @PSCALE_PORT, @PAY_CARD_PORT = @PPAY_CARD_PORT, @PRINT_DESING = @PPRINT_DESING ",param:["PGUID:string|50","PCUSER:string|25","PCODE:string|50","PNAME:string|50","PLCD_PORT:string|50","PSCALE_PORT:string|50","PPAY_CARD_PORT:string|50","PPRINT_DESING:string|50"],dataprm:["GUID","CUSER","CODE","NAME","LCD_PORT","SCALE_PORT","PAY_CARD_PORT","PRINT_DESING"]},t.updateCmd={query:"EXEC [dbo].[PRD_POS_DEVICE_UPDATE] @GUID = @PGUID, @CUSER = @PCUSER, @CODE = @PCODE, @NAME = @PNAME, @LCD_PORT = @PLCD_PORT, @SCALE_PORT = @PSCALE_PORT, @PAY_CARD_PORT = @PPAY_CARD_PORT, @PRINT_DESING = @PPRINT_DESING ",param:["PGUID:string|50","PCUSER:string|25","PCODE:string|50","PNAME:string|50","PLCD_PORT:string|50","PSCALE_PORT:string|50","PPAY_CARD_PORT:string|50","PPRINT_DESING:string|50"],dataprm:["GUID","CUSER","CODE","NAME","LCD_PORT","SCALE_PORT","PAY_CARD_PORT","PRINT_DESING"]},t.deleteCmd={query:"EXEC [dbo].[PRD_POS_DEVICE_DELETE] @CUSER = @PCUSER, @UPDATE = 1, @GUID = @PGUID ",param:["PCUSER:string|25","PGUID:string|50"],dataprm:["CUSER","GUID"]},this.ds.add(t)}},{key:"dt",value:function(){return arguments.length>0?this.ds.get(arguments[0]):this.ds.get(0)}},{key:"addEmpty",value:function(){if(void 0!==this.dt("POS_DEVICE")){var t={};(t=f({},arguments.length>0?arguments[0]:this.empty)).GUID=p.$A.uuidv4(),this.dt("POS_DEVICE").push(t)}}},{key:"clearAll",value:function(){for(var t=0;t<this.ds.length;t++)this.dt(t).clear()}},{key:"load",value:function(){var t=arguments,e=this;return new Promise(function(){var r=(0,s.Z)(l().mark((function r(n){var i;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={GUID:"00000000-0000-0000-0000-000000000000",CODE:""},t.length>0&&(i.GUID=void 0===t[0].GUID?"00000000-0000-0000-0000-000000000000":t[0].GUID,i.CODE=void 0===t[0].CODE?"":t[0].CODE),e.ds.get("POS_DEVICE").selectCmd.value=Object.values(i),Object.keys(i).forEach((function(t){void 0!==i[t]&&"00000000-0000-0000-0000-000000000000"!=i[t]&&""!=i[t]&&-1!=i[t]||delete i[t]})),e.ds.get("POS_DEVICE").selectCmd.local.where=0==Object.keys(i).length?void 0:i,r.next=7,e.ds.get("POS_DEVICE").refresh();case 7:n(e.ds.get("POS_DEVICE"));case 8:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"save",value:function(){var t=this;return new Promise(function(){var e=(0,s.Z)(l().mark((function e(r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ds.delete(),e.t0=r,e.next=4,t.ds.update();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"lcdPrint",value:function(t){if(p.vE.instance.util.isElectron()){var e=new this.escpos.Serial(this.dt().length>0?this.dt()[0].LCD_PORT:"",{baudRate:9600,autoOpen:!1}),r=new this.escpos.Screen(e,{encoding:"GB18030"});e.open((function(e){r.blink(t.blink),r.clear(),r.text(t.text).close()}))}}},{key:"lcdClear",value:function(){if(p.vE.instance.util.isElectron()){var t=new this.escpos.Serial(this.dt().length>0?this.dt()[0].LCD_PORT:"",{baudRate:9600,autoOpen:!1}),e=new this.escpos.Screen(t,{encoding:"GB18030"});t.open((function(t){e.clear()}))}}},{key:"caseOpen",value:function(){var t=this;return new Promise((function(e){if(p.vE.instance.util.isElectron()){var r=new t.escpos.USB,n=new t.escpos.Printer(r,{encoding:"GB18030"});r.open(function(){var t=(0,s.Z)(l().mark((function t(r){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.cashdraw(2),n.close(),t.next=4,p.vE.instance.util.waitUntil(500);case 4:e();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else e()}))}},{key:"mettlerScaleSend",value:function(t){var e=this;if(p.vE.instance.util.isElectron()){var r=function(t){for(var e="",r=0;r<t.length;r++)e+=t.charCodeAt(r).toString(16);return e};return new Promise((function(n){var i=new e.serialport(e.dt().length>0?e.dt()[0].SCALE_PORT:"",{baudRate:9600,dataBits:7,parity:"odd",stopBits:1}),s=parseInt(100*t).toString().padStart(6,"0");i.write("01"+s+"");var a="";return i.on("data",(function(t){if("6"==r(t.toString())?i.write(""):"15"==r(t.toString())&&i.write("01"+s+""),"11"==t.toString().substring(1,3))if("2"==t.toString().substring(4,5)){var e=("000"+parseInt(65535&(c=11324,l=t.toString().substring(5,6),(c&=65535)<<(l&=15)|11324>>16-l)).toString(16)).slice(-4).toString().toUpperCase(),o=("000"+parseInt(65535&function(t,e){return(t&=65535)>>(e&=15)|64007<<16-e}(64007,t.toString().substring(6,7))).toString(16)).slice(-4).toString().toUpperCase(),u=e+o;i.write("10"+u.toString()+"")}else"0"==t.toString().substring(4,5)?i.write("01"+s+""):"1"==t.toString().substring(4,5)&&(console.log("Validasyon Başarılı"),n({Type:"01",Result:{Msg:"Validasyon Başarılı"}}),i.close());var c,l;if(("02"==t.toString().substring(1,3)||"02"==a.substring(1,3))&&(a+=t.toString()).length>=26){var p=a.substring(6,11),d=a.substring(12,18),P=a.substring(19,25);n({Type:"02",Result:{Scale:p/1e3,Price:d/100,Amount:P/100}}),a="",i.close()}})),setTimeout((function(){i.isOpen&&i.close()}),2e4),i.on("close",n)}))}}},{key:"cardPayment",value:(e=(0,s.Z)(l().mark((function t(e){var n,i,a,o,u,c=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,p.vE.instance.util.isElectron()){t.next=5;break}return t.abrupt("return");case 5:n=r.g.require("serialport");case 6:if(i=!1,a="card",null==this.payPort||!this.payPort.isOpen){t.next=11;break}return t.next=11,this.core.util.waitUntil(2e3);case 11:return o=function(t){var e=0,r=t.split("");for(var n in r)void 0!==r[n].charCodeAt&&(e^=r[n].charCodeAt(0));return console.log("lrc => ",e),e},u=function(t,e){for(var r=0;r<e.length;r++)if(String.fromCharCode(e[r])==String.fromCharCode(t))return!0;return!1},t.abrupt("return",new Promise(function(){var t=(0,s.Z)(l().mark((function t(r){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c.core.util.writeLog("signal : 1"),null!=c.payPort&&c.payPort.isOpen||(c.payPort=new n(c.dt().length>0?c.dt()[0].PAY_CARD_PORT:"",{baudRate:9600,dataBits:7,parity:"odd",parser:new c.serialport.parsers.Readline})),c.core.util.writeLog("signal : 2"),c.payPort.write(String.fromCharCode(5)),c.payPort.on("data",function(){var t=(0,s.Z)(l().mark((function t(n){var s,p,d,P,h,f,E;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c.core.util.writeLog("signal : 3"),c.core.util.writeLog("full data : "+n.toString()),(i||String.fromCharCode(6)!=String.fromCharCode(n[0]))&&String.fromCharCode(21)!=String.fromCharCode(n[0])){t.next=20;break}if(c.core.util.writeLog("signal : 4"),s={pos_number:"01",amount_msg:("0000000"+(100*e).toFixed(0)).substr(-8),answer_flag:"0",payment_mode:"check"==a?"C":"1",transaction_type:"0",currency_numeric:978,private:"          ",delay:"A010",auto:"B010"},!((p=Object.keys(s).map((function(t){return s[t]})).join("")).length>34)){t.next=12;break}return t.next=9,c.payPort.close();case 9:return r({tag:"response",msg:"error"}),console.log("ERR. : failed data > 34 characters.",p),t.abrupt("return");case 12:d=p.toString().concat(String.fromCharCode(3)),P=o(d),h=String.fromCharCode(2).concat(d).concat(String.fromCharCode(P)),c.payPort.write(h),i=!0,c.core.util.writeLog("send data : "+h),t.next=44;break;case 20:if(!i||String.fromCharCode(6)!=String.fromCharCode(n[0])){t.next=25;break}c.core.util.writeLog("send eot"),c.payPort.write(String.fromCharCode(4)),t.next=44;break;case 25:if(String.fromCharCode(5)!=String.fromCharCode(n[0])){t.next=30;break}c.core.util.writeLog("send ack"),c.payPort.write(String.fromCharCode(6)),t.next=44;break;case 30:if(!(n.length>=25)){t.next=38;break}f="",f=String.fromCharCode(n[0])==String.fromCharCode(2)?n.toString().substr(1,n.toString().length-3):n.toString().substr(0,n.toString().length-3),E={pos_number:f.substr(0,2),transaction_result:f.charAt(2),amount_msg:f.substr(3,8),payment_mode:f.charAt(11),currency_numeric:f.substr(12,3),private:f.substr(15,11)},c.core.util.writeLog("response : "+E),r({tag:"response",msg:JSON.stringify(E)}),t.next=44;break;case 38:if(!u(4,n)){t.next=44;break}if(c.core.util.writeLog("signal : 8"),!c.payPort.isOpen){t.next=44;break}return c.core.util.writeLog("signal : 9"),t.next=44,c.payPort.close();case 44:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 14:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"escPrinter",value:function(t){var e=this;return new Promise(function(){var r=(0,s.Z)(l().mark((function r(a){var o,u,c,d;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(p.vE.instance.util.isElectron()){r.next=3;break}return a(),r.abrupt("return");case 3:o=new e.escpos.USB,u={encoding:"GB18030"},c=new e.escpos.Printer(o,u),d=function(t){return new Promise((function(r){e.escpos.Image.load(t,(function(t){r(t)}))}))},o.open(function(){var e=(0,s.Z)(l().mark((function e(r){var s,o,u,p,P;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(null!=r&&console.log(r),s=[],o=0;o<t.length;o++)u=t[o],"function"==typeof t[o]&&(u=t[o]()),Array.isArray(u)?s.push.apply(s,(0,i.Z)(u)):"object"==(0,n.Z)(u)&&s.push(u);p=0;case 4:if(!(p<s.length)){e.next=25;break}if(void 0===s[p].barcode){e.next=9;break}c.align(s[p].align).barcode(s[p].barcode,"CODE39",s[p].options),e.next=22;break;case 9:if(void 0===s[p].logo){e.next=16;break}return e.next=12,d(s[p].logo);case 12:P=e.sent,c.align(s[p].align).image(P,"s8").then((function(){})),e.next=22;break;case 16:c.size(0,0),c.font(s[p].font),c.align(s[p].align),void 0!==s[p].style?c.style(s[p].style):c.style("normal"),void 0!==s[p].size&&c.size(s[p].size[0],s[p].size[1]),c.text(s[p].data,"857");case 22:p++,e.next=4;break;case 25:c.cut().close((function(){a()}));case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"scanner",value:function(){var t=this;if(p.vE.instance.util.isElectron()&&(null==this.scannerPort||!this.scannerPort.isOpen)){this.scannerPort=new this.serialport(this.dt().length>0?this.dt()[0].SCANNER_PORT:"");var e=0,r="";this.scannerPort.on("data",(function(n){e++,r+=n.toString("utf8"),2==e&&(r=11==r.length?r.substring(2,10):r.substring(1,14),t.emit("scanner",r),e=0,r="")}))}}}]),t}()},55585:(t,e,r)=>{r.d(e,{ZP:()=>d});var n=r(15671),i=r(43144),s=r(97326),a=r(60136),o=r(82963),u=r(61120),c=r(67294),l=r(60250),p=r.n(l);var d=function(t){(0,a.Z)(d,t);var e,r,l=(e=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,u.Z)(e);if(r){var i=(0,u.Z)(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return(0,o.Z)(this,t)});function d(t){var e;return(0,n.Z)(this,d),(e=l.call(this,t)).state.value=void 0!==t.value&&t.value,e._onValueChanged=e._onValueChanged.bind((0,s.Z)(e)),e}return(0,i.Z)(d,[{key:"_onValueChanged",value:function(t){this.value=t.value,void 0!==this.props.onValueChanged&&this.props.onValueChanged(t)}},{key:"value",get:function(){return this.state.value},set:function(t){var e=this;if(void 0!==t){if(void 0!==this.props.dt&&void 0!==this.props.dt.data&&this.props.dt.data.length>0&&void 0!==this.props.dt.field)if(void 0===this.props.dt.filter)void 0!==this.props.dt.row&&void 0!==this.props.dt.data.find((function(t){return t===e.props.dt.row}))?this.props.dt.data.find((function(t){return t===e.props.dt.row}))[this.props.dt.field]=t:this.props.dt.data[this.props.dt.data.length-1][this.props.dt.field]=t;else{var r=this.props.dt.data.where(this.props.dt.filter);r.length>0&&(void 0!==this.props.dt.row&&void 0!==r.find((function(t){return t===e.props.dt.row}))?r.find((function(t){return t===e.props.dt.row}))[this.props.dt.field]=t:r[r.length-1][this.props.dt.field]=t)}this.setState({value:t})}}},{key:"render",value:function(){return c.createElement(p(),{id:this.props.id,defaultValue:this.props.defaultValue,value:this.state.value,text:this.props.text,onValueChanged:this._onValueChanged},this.props.children,this.validationView())}}]),d}(r(20819).ZP)}}]);