"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[8108],{68108:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var a=n(4942),r=n(15861),i=n(15671),c=n(43144),s=n(97326),o=n(60136),l=n(82963),d=n(61120),u=n(64687),h=n.n(u),m=n(67294),E=n(85107),p=n(4598),b=(n(30381),n(42866)),f=n.n(b),O=(n(53221),n(25552)),T=n.n(O),x=(n(41226),n(65580)),C=n.n(x),g=(n(91686),n(30886),n(99846)),D=n(5083),I=n(99077),v=n(55585),R=n(417),N=n(32175),A=n(18405),w=n(73682),y=n(90428),P=(n(57941),n(60547));function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n(17276),n(9279);var _=function(t){(0,o.Z)(B,t);var e,n,a,u,b,x,U,_,k,M,j,L,F,Z,V=(F=B,Z=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,d.Z)(F);if(Z){var n=(0,d.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function B(t){var e;return(0,i.Z)(this,B),(e=V.call(this,t)).state={tbMain:"visible",tbBarcode:"hidden",tbDocument:"hidden"},e.barcode={name:"",vat:0,barcode:"",code:"",guid:"00000000-0000-0000-0000-000000000000"},e.core=E.Z.instance.core,e.prmObj=e.param.filter({TYPE:1,USERS:e.user.CODE}),e.acsobj=e.access.filter({TYPE:1,USERS:e.user.CODE}),e.docObj=new p.Ch,e.tabIndex=t.data.tabkey,e.dropmenuMainItems=[e.t("btnNew"),e.t("btnSave")],e.dropmenuDocItems=[e.t("btnSave")],e._calculateTotal=e._calculateTotal.bind((0,s.Z)(e)),e._getRebate=e._getRebate.bind((0,s.Z)(e)),e.pageChange=e.pageChange.bind((0,s.Z)(e)),e.setBarcode=e.setBarcode.bind((0,s.Z)(e)),e.dropmenuClick=e.dropmenuClick.bind((0,s.Z)(e)),e.frmDocItems=void 0,e.docLocked=!1,e.combineControl=!0,e.combineNew=!1,e.rightItems=[{text:e.t("getRebate")}],e}return(0,c.Z)(B,[{key:"componentDidMount",value:(L=(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.util.waitUntil(0);case 2:this.init(),void 0!==this.pagePrm&&this.getDoc(this.pagePrm.GUID,"",0);case 4:case"end":return t.stop()}}),t,this)}))),function(){return L.apply(this,arguments)})},{key:"init",value:(j=(0,r.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.docObj.clearAll(),(e=S({},this.docObj.empty)).TYPE=1,e.DOC_TYPE=40,e.REBATE=1,this.docObj.addEmpty(e),this.txtRef.readOnly=!1,this.txtRefno.readOnly=!1,this.docLocked=!1,this.frmDocItems.option("disabled",!1),t.next=12,this.grdRebtDispatch.dataRefresh({source:this.docObj.docItems.dt("DOC_ITEMS")});case 12:case"end":return t.stop()}}),t,this)}))),function(){return j.apply(this,arguments)})},{key:"getDoc",value:(M=(0,r.Z)(h().mark((function t(e,n,a){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.docObj.clearAll(),t.next=3,this.docObj.load({GUID:e,REF:n,REF_NO:a,TYPE:1,DOC_TYPE:40});case 3:if(this._calculateMargin(),this._calculateTotalMargin(),this.txtRef.readOnly=!0,this.txtRefno.readOnly=!0,0==this.docObj.dt()[0].LOCKED){t.next=15;break}return this.docLocked=!0,r={id:"msgGetLocked",showTitle:!0,title:this.t("msgGetLocked.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgGetLocked.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgGetLocked.msg"))},t.next=12,(0,P.W)(r);case 12:this.frmDocItems.option("disabled",!0),t.next=17;break;case 15:this.docLocked=!1,this.frmDocItems.option("disabled",!1);case 17:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return M.apply(this,arguments)})},{key:"checkDoc",value:(k=(0,r.Z)(h().mark((function t(e,n,a){var i=this;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=(0,r.Z)(h().mark((function t(r){var c;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""===n){t.next=15;break}return t.next=3,(new p.Ch).load({GUID:e,REF:n,REF_NO:a});case 3:if(!(t.sent.length>0)){t.next=12;break}return c={id:"msgCode",showTitle:!0,title:"Dikkat",showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:"Evrağa Git",location:"before"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},"Evrak Bulundu")},t.next=8,(0,P.W)(c);case 8:"btn01"==t.sent?(i.getDoc(e,n,a),r(2)):r(3),t.next=13;break;case 12:r(1);case 13:t.next=16;break;case 15:r(0);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),function(t,e,n){return k.apply(this,arguments)})},{key:"_calculateTotal",value:(_=(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.docObj.dt()[0].AMOUNT=this.docObj.docItems.dt().sum("AMOUNT",2),this.docObj.dt()[0].DISCOUNT=this.docObj.docItems.dt().sum("DISCOUNT",2),this.docObj.dt()[0].VAT=this.docObj.docItems.dt().sum("VAT",2),this.docObj.dt()[0].TOTAL=this.docObj.docItems.dt().sum("TOTAL",2),this._calculateTotalMargin();case 5:case"end":return t.stop()}}),t,this)}))),function(){return _.apply(this,arguments)})},{key:"_calculateTotalMargin",value:(U=(0,r.Z)(h().mark((function t(){var e,n,a,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=0,n=0;n<this.docObj.docItems.dt().length;n++)e+=this.docObj.docItems.dt()[n].COST_PRICE*this.docObj.docItems.dt()[n].QUANTITY;a=this.docObj.dt()[0].TOTAL-this.docObj.dt()[0].VAT-e,r=100*(this.docObj.dt()[0].TOTAL-this.docObj.dt()[0].VAT-e-(this.docObj.dt()[0].TOTAL-this.docObj.dt()[0].VAT)),this.docObj.dt()[0].MARGIN=a.toFixed(2)+"€ / %"+r.toFixed(2);case 5:case"end":return t.stop()}}),t,this)}))),function(){return U.apply(this,arguments)})},{key:"_calculateMargin",value:(x=(0,r.Z)(h().mark((function t(){var e,n,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=0;e<this.docObj.docItems.dt().length;e++)n=this.docObj.docItems.dt()[e].TOTAL-this.docObj.docItems.dt()[e].VAT-this.docObj.docItems.dt()[e].COST_PRICE*this.docObj.docItems.dt()[e].QUANTITY,a=n/(this.docObj.docItems.dt()[e].TOTAL-this.docObj.docItems.dt()[e].VAT)*100,this.docObj.docItems.dt()[e].MARGIN=n.toFixed(2)+"€ / %"+a.toFixed(2);case 1:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"addItem",value:(b=(0,r.Z)(h().mark((function t(e){var n,a,r,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e&&(e=1),""!=this.txtBarcode.value){t.next=6;break}return n={id:"msgBarcodeCheck",showTitle:!0,title:this.t("msgBarcodeCheck.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgBarcodeCheck.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgBarcodeCheck.msg"))},t.next=5,(0,P.W)(n);case 5:return t.abrupt("return");case 6:a=0;case 7:if(!(a<this.docObj.docItems.dt().length)){t.next=22;break}if(this.docObj.docItems.dt()[a].CODE!=this.barcode.code){t.next=19;break}return r={id:"msgCombineItem",showTitle:!0,title:this.t("msgCombineItem.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgCombineItem.btn01"),location:"before"},{id:"btn02",caption:this.t("msgCombineItem.btn02"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgCombineItem.msg"))},t.next=12,(0,P.W)(r);case 12:if("btn01"!=t.sent){t.next=18;break}return this.barcodeReset(),t.abrupt("return");case 18:return t.abrupt("break",22);case 19:a++,t.next=7;break;case 22:return(i=S({},this.docObj.docItems.empty)).REF=this.docObj.dt()[0].REF,i.REF_NO=this.docObj.dt()[0].REF_NO,i.ITEM_NAME=this.barcode.name,i.ITEM_CODE=this.barcode.code,i.ITEM=this.barcode.guid,i.DOC_GUID=this.docObj.dt()[0].GUID,i.TYPE=this.docObj.dt()[0].TYPE,i.DOC_TYPE=this.docObj.dt()[0].DOC_TYPE,i.LINE_NO=this.docObj.docItems.dt().length,i.REF=this.docObj.dt()[0].REF,i.REF_NO=this.docObj.dt()[0].REF_NO,i.OUTPUT=this.docObj.dt()[0].OUTPUT,i.INPUT=this.docObj.dt()[0].INPUT,i.DOC_DATE=this.docObj.dt()[0].DOC_DATE,i.QUANTITY=e,i.VAT_RATE=this.barcode.vat,i.PRICE=this.txtPrice.value,i.VAT=(this.txtPrice.value*(this.barcode.vat/100)*e).toFixed(2),i.AMOUNT=(this.txtPrice.value*e).toFixed(2),i.TOTAL=parseFloat(this.txtPrice.value*e+this.txtVat.value*e).toFixed(2),this.docObj.docItems.addEmpty(i),this.barcodeReset(),this._calculateTotal(),t.next=48,this.docObj.save();case 48:case"end":return t.stop()}}),t,this)}))),function(t){return b.apply(this,arguments)})},{key:"_getRebate",value:(u=(0,r.Z)(h().mark((function t(){var e,n,a=this;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={query:"SELECT *,[dbo].[FN_DEPOT_QUANTITY]([ITEM_GUID],@DEPOT,GETDATE()) AS QUANTITY FROM ITEM_MULTICODE_VW_01 WHERE [dbo].[FN_DEPOT_QUANTITY]([ITEM_GUID],@DEPOT,GETDATE()) > 0 AND CUSTOMER_GUID = @CUSTOMER",param:["DEPOT:string|50","CUSTOMER:string|50"],value:[this.docObj.dt()[0].OUTPUT,this.docObj.dt()[0].INPUT]},t.next=3,this.core.sql.execute(e);case 3:if(!((n=t.sent).result.recordset.length>0)){t.next=7;break}return t.next=7,this.pg_RebateGrid.setData(n.result.recordset);case 7:this.pg_RebateGrid.show(),this.pg_RebateGrid.onClick=function(){var t=(0,r.Z)(h().mark((function t(e){var n,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.length)){t.next=28;break}return(r=S({},a.docObj.docItems.empty)).DOC_GUID=a.docObj.dt()[0].GUID,r.TYPE=a.docObj.dt()[0].TYPE,r.DOC_TYPE=a.docObj.dt()[0].DOC_TYPE,r.REBATE=a.docObj.dt()[0].REBATE,r.LINE_NO=a.docObj.docItems.dt().length,r.REF=a.docObj.dt()[0].REF,r.REF_NO=a.docObj.dt()[0].REF_NO,r.INPUT=a.docObj.dt()[0].INPUT,r.OUTPUT=a.docObj.dt()[0].OUTPUT,r.DOC_DATE=a.docObj.dt()[0].DOC_DATE,r.SHIPMENT_DATE=a.docObj.dt()[0].SHIPMENT_DATE,r.ITEM=e[n].ITEM_GUID,r.ITEM_CODE=e[n].ITEM_CODE,r.ITEM_NAME=e[n].ITEM_NAME,r.PRICE=e[n].CUSTOMER_PRICE,r.QUANTITY=e[n].QUANTITY,r.AMOUNT=parseFloat((e[n].CUSTOMER_PRICE*e[n].QUANTITY).toFixed(3)),r.TOTAL=parseFloat((e[n].CUSTOMER_PRICE*e[n].QUANTITY).toFixed(3)),t.next=23,a.docObj.docItems.addEmpty(r);case 23:return t.next=25,a.core.util.waitUntil(100);case 25:n++,t.next=1;break;case 28:a.docObj.docItems.dt().emit("onRefresh"),a._calculateTotal();case 30:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 9:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"barcodeReset",value:function(){0==this.chkAutoAdd.value&&(this.barcode={name:"",vat:0,barcode:"",code:"",guid:"00000000-0000-0000-0000-000000000000"}),this.txtBarcode.value="",this.txtAmount.value=0,this.txtVat.value=0,this.txtQuantity.value=0,this.txtPrice.value=0,this.setState({tbBarcode:"visible"}),this.txtBarcode.focus()}},{key:"pageChange",value:(a=(0,r.Z)(h().mark((function t(e){var n,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Main"==e&&(this.setState({tbMain:"visible"}),this.setState({tbBarcode:"hidden"}),this.setState({tbDocument:"hidden"})),"Barcode"!=e){t.next=20;break}if(""!=this.cmbDepot.value){t.next=10;break}return n={id:"msgDepotSelect",showTitle:!0,title:this.t("msgDepotSelect.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgDepotSelect.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgDepotSelect.msg"))},t.next=6,(0,P.W)(n);case 6:return t.sent,t.abrupt("return");case 10:if(""!=this.docObj.dt()[0].INPUT_CODE){t.next=16;break}return a={id:"msgCustomerSelect",showTitle:!0,title:this.t("msgCustomerSelect.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgCustomerSelect.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgCustomerSelect.msg"))},t.next=14,(0,P.W)(a);case 14:return t.sent,t.abrupt("return");case 16:this.setState({tbMain:"hidden"}),this.setState({tbBarcode:"visible"}),this.setState({tbDocument:"hidden"}),this.txtBarcode.focus();case 20:"Document"==e&&(this.setState({tbMain:"hidden"}),this.setState({tbBarcode:"hidden"}),this.setState({tbDocument:"visible"}));case 21:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"calculateItemPrice",value:function(){this.txtVat.value=parseFloat((this.txtPrice.value*(this.barcode.vat/100)*this.txtQuantity.value).toFixed(2)),this.txtAmount.value=parseFloat(this.txtPrice.value*this.txtQuantity.value+this.txtVat.value).toFixed(2)}},{key:"setBarcode",value:(n=(0,r.Z)(h().mark((function t(){var e,n,a,i=this;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.txtQuantity.value=1,e={query:"SELECT MULTICODE,CUSTOMER_PRICE AS PRICE FROM ITEM_MULTICODE_VW_01 WHERE ITEM_CODE = @ITEM_CODE AND CUSTOMER_GUID = @CUSTOMER_GUID",param:["ITEM_CODE:string|50","CUSTOMER_GUID:string|50"],value:[this.barcode.code,this.docObj.dt()[0].INPUT]},t.next=4,this.core.sql.execute(e);case 4:if(0!=(n=t.sent).result.recordset.length){t.next=13;break}return a={id:"msgCustomerNotFound",showTitle:!0,title:this.t("msgCustomerNotFound.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:this.t("msgCustomerNotFound.btn01"),location:"before"},{id:"btn02",caption:this.t("msgCustomerNotFound.btn02"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgCustomerNotFound.msg"))},t.next=9,(0,P.W)(a);case 9:if("btn02"!=t.sent){t.next=13;break}return this.barcodeReset(),t.abrupt("return");case 13:if(n.result.recordset.length>0&&(this.txtPrice.value=parseFloat(n.result.recordset[0].PRICE.toFixed(2)),this.txtVat.value=parseFloat((n.result.recordset[0].PRICE*(this.barcode.vat/100)).toFixed(2)),this.txtAmount.value=parseFloat((Number(this.txtPrice.value)+Number(this.txtVat.value)).toFixed(2))),1!=this.chkAutoAdd.value){t.next=20;break}return setTimeout((0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.txtPopQuantity.focus();case 1:case"end":return t.stop()}}),t)}))),500),t.next=18,this.msgQuantity.show().then(function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"btn01"==e&&i.addItem(i.txtPopQuantity.value);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 18:t.next=21;break;case 20:this.txtQuantity.focus();case 21:this.setState({tbBarcode:"visible"});case 22:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"dropmenuClick",value:(e=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.itemData==this.t("btnNew")&&this.init();case 1:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"render",value:function(){var t,e,n,a,i=this;return m.createElement(f(),null,m.createElement("div",null,m.createElement("div",{className:"row px-1 pt-1"},m.createElement("div",{className:"row px-1 pt-1",style:{visibility:this.state.tbMain,position:"absolute"}},m.createElement(T(),{colCount:1},m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtRefRefno"),alignment:"right"}),m.createElement("div",{className:"row"},m.createElement("div",{className:"col-5 pe-0"},m.createElement(g.ZP,{id:"txtRef",parent:this,simple:!0,dt:{data:this.docObj.dt("DOC"),field:"REF"},upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,readOnly:!0,maxLength:32,onChange:(0,r.Z)(h().mark((function t(){var e,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={query:"SELECT ISNULL(MAX(REF_NO) + 1,1) AS REF_NO FROM DOC WHERE TYPE = 1 AND DOC_TYPE = 40 AND REF = @REF ",param:["REF:string|25"],value:[i.txtRef.value]},t.next=3,i.core.sql.execute(e);case 3:(n=t.sent).result.recordset.length>0&&(i.txtRefno.value=n.result.recordset[0].REF_NO);case 5:case"end":return t.stop()}}),t)}))).bind(this),param:this.param.filter({ELEMENT:"txtRef",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtRef",USERS:this.user.CODE})},m.createElement(g.cX,{validationGroup:"frmLabelQeueu"},m.createElement(g.n2,{message:this.t("validRef")})))),m.createElement("div",{className:"col-7 ps-0"},m.createElement(g.ZP,{id:"txtRefno",parent:this,simple:!0,dt:{data:this.docObj.dt("DOC"),field:"REF_NO"},upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,readOnly:!0,button:[{id:"01",icon:"more",onClick:(a=(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.pg_Docs.show(),i.pg_Docs.onClick=function(t){t.length>0&&i.getDoc(t[0].GUID,t[0].REF,t[0].REF_NO)};case 2:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{id:"02",icon:"arrowdown",onClick:function(){i.txtRefno.value=Math.floor(Date.now()/1e3)}}],onChange:(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.checkDoc("00000000-0000-0000-0000-000000000000",i.txtRef.value,i.txtRefno.value);case 2:3==t.sent&&(i.txtRefno.value="");case 4:case"end":return t.stop()}}),t)}))).bind(this),param:this.param.filter({ELEMENT:"txtRefno",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtRefno",USERS:this.user.CODE})},m.createElement(g.cX,{validationGroup:"frmLabelQeueu"},m.createElement(g.n2,{message:this.t("validRefNo")}))))),m.createElement(R.Z,{id:"pg_Docs",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",selection:{mode:"single"},title:this.t("pg_Docs.title"),data:{source:{select:{query:"SELECT GUID,REF,REF_NO,INPUT_CODE,INPUT_NAME FROM DOC_VW_01 WHERE TYPE = 1 AND DOC_TYPE = 40 AND REBATE = 1"},sql:this.core.sql}},button:[{id:"01",icon:"more",onClick:function(){}}]},m.createElement(A.sg,{dataField:"REF",caption:this.t("pg_Docs.clmRef"),width:150,defaultSortOrder:"asc"}),m.createElement(A.sg,{dataField:"REF_NO",caption:this.t("pg_Docs.clmRefNo"),width:100,defaultSortOrder:"asc"}),m.createElement(A.sg,{dataField:"INPUT_NAME",caption:this.t("pg_Docs.clmInputName"),width:300,defaultSortOrder:"asc"}),m.createElement(A.sg,{dataField:"INPUT_CODE",caption:this.t("pg_Docs.clmInputCode"),width:300,defaultSortOrder:"asc"}))),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("cmbDepot"),alignment:"right"}),m.createElement(I.ZP,{simple:!0,parent:this,id:"cmbDepot",notRefresh:!0,dt:{data:this.docObj.dt("DOC"),field:"OUTPUT"},displayExpr:"NAME",valueExpr:"GUID",value:"",searchEnabled:!0,onValueChanged:(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this),data:{source:{select:{query:"SELECT * FROM DEPOT_VW_01 WHERE TYPE = 1"},sql:this.core.sql}},param:this.param.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE})},m.createElement(g.cX,{validationGroup:"frmRebateDis"+this.tabIndex},m.createElement(g.n2,{message:this.t("validDepot")})))),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtCustomerCode"),alignment:"right"}),m.createElement(g.ZP,{id:"txtCustomerCode",parent:this,simple:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,dt:{data:this.docObj.dt("DOC"),field:"INPUT_CODE"},onEnterKey:(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.pg_txtCustomerCode.setVal(i.txtCustomerCode.value);case 2:i.pg_txtCustomerCode.show(),i.pg_txtCustomerCode.onClick=function(t){if(t.length>0){i.docObj.dt()[0].INPUT=t[0].GUID,i.docObj.dt()[0].INPUT_CODE=t[0].CODE,i.docObj.dt()[0].INPUT_NAME=t[0].TITLE;var e=i.sysParam.filter({ID:"refForCustomerCode",USERS:i.user.CODE}).getValue();void 0!==e&&1==e.value&&(i.txtRef.value=t[0].CODE,i.txtRef.props.onChange())}};case 4:case"end":return t.stop()}}),t)}))).bind(this),button:[{id:"01",icon:"more",onClick:function(){i.pg_txtCustomerCode.show(),i.pg_txtCustomerCode.onClick=function(t){if(t.length>0){i.docObj.dt()[0].INPUT=t[0].GUID,i.docObj.dt()[0].INPUT_CODE=t[0].CODE,i.docObj.dt()[0].INPUT_NAME=t[0].TITLE;var e=i.sysParam.filter({ID:"refForCustomerCode",USERS:i.user.CODE}).getValue();void 0!==e&&1==e.value&&(i.txtRef.value=t[0].CODE,i.txtRef.props.onChange())}}}}],param:this.param.filter({ELEMENT:"txtCustomerCode",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtCustomerCode",USERS:this.user.CODE})},m.createElement(g.cX,{validationGroup:"frmRebateDis"+this.tabIndex},m.createElement(g.n2,{message:this.t("validCustomerCode")}))),m.createElement(R.Z,{id:"pg_txtCustomerCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("pg_txtCustomerCode.title"),search:!0,data:{source:{select:{query:"SELECT GUID,CODE,TITLE,NAME,LAST_NAME,[TYPE_NAME],[GENUS_NAME] FROM CUSTOMER_VW_01 WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(TITLE) LIKE UPPER(@VAL)",param:["VAL:string|50"]},sql:this.core.sql}},button:{id:"01",icon:"more",onClick:function(){console.log(1111)}}},m.createElement(A.sg,{dataField:"CODE",caption:this.t("pg_txtCustomerCode.clmCode"),width:150}),m.createElement(A.sg,{dataField:"TITLE",caption:this.t("pg_txtCustomerCode.clmTitle"),width:500,defaultSortOrder:"asc"}),m.createElement(A.sg,{dataField:"TYPE_NAME",caption:this.t("pg_txtCustomerCode.clmTypeName"),width:150}),m.createElement(A.sg,{dataField:"GENUS_NAME",caption:this.t("pg_txtCustomerCode.clmGenusName"),width:150,filterType:"include",filterValues:["Tedarikçi"]}))),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtCustomerName"),alignment:"right"}),m.createElement(g.ZP,{id:"txtCustomerName",parent:this,simple:!0,readOnly:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,dt:{data:this.docObj.dt("DOC"),field:"INPUT_NAME"},param:this.param.filter({ELEMENT:"txtCustomerName",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtCustomerName",USERS:this.user.CODE})})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("dtDocDate"),alignment:"right"}),m.createElement(y.ZP,{simple:!0,parent:this,id:"dtDocDate",pickerType:"rollers",dt:{data:this.docObj.dt("DOC"),field:"DOC_DATE"},onValueChanged:(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)},m.createElement(g.cX,{validationGroup:"frmRebateDis"+this.tabIndex},m.createElement(g.n2,{message:this.t("validDocDate")})))),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("dtShipDate"),alignment:"right"}),m.createElement(y.ZP,{simple:!0,parent:this,id:"dtShipDate",pickerType:"rollers",dt:{data:this.docObj.dt("DOC"),field:"SHIPMENT_DATE"},onValueChanged:(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)},m.createElement(g.cX,{validationGroup:"frmRebateDis"+this.tabIndex},m.createElement(g.n2,{message:this.t("validDocDate")})))),m.createElement(O.Item,null,m.createElement("div",{className:"row"},m.createElement("div",{className:"col-6 px-2 pt-2"},m.createElement(w.Z,{text:this.t("btnBarcodeEntry"),type:"default",width:"100%",onClick:function(){return i.pageChange("Barcode")}})),m.createElement("div",{className:"col-6 px-2 pt-2"},m.createElement(w.Z,{text:this.t("btnDocument"),type:"default",width:"100%",onClick:function(){return i.pageChange("Document")}})))))),m.createElement("div",{className:"row px-1 pt-1",style:{visibility:this.state.tbBarcode,position:"absolute"}},m.createElement(T(),{colCount:1},m.createElement(O.Item,null,m.createElement("div",{className:"row",style:{height:"25px"}},m.createElement("div",{className:"col-4 px-1 pt-1"},m.createElement(w.Z,{icon:"arrowleft",type:"default",width:"100%",onClick:function(){return i.pageChange("Main")}})),m.createElement("div",{className:"col-4 px-1 pt-1"},m.createElement(w.Z,{icon:"detailslayout",type:"default",width:"100%",onClick:function(){return i.pageChange("Document")}})),m.createElement("div",{className:"col-4 px-1 pt-1"},m.createElement(v.ZP,{id:"chkAutoAdd",text:this.t("chkAutoAdd"),parent:this,defaultValue:!0,value:!0,param:this.param.filter({ELEMENT:"chkAutoAdd",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"chkAutoAdd",USERS:this.user.CODE})})))),m.createElement(O.Item,null,m.createElement("div",{className:"col-12 px-2 pt-2"},m.createElement(g.ZP,{id:"txtBarcode",parent:this,placeholder:this.t("txtBarcodePlace"),button:[{id:"01",icon:"more",onClick:(n=(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.popItemCode.show(),i.popItemCode.onClick=function(){var t=(0,r.Z)(h().mark((function t(e){var n,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!=e.length){t.next=8;break}return i.txtBarcode.value=e[0].CODE,i.barcode={name:e[0].NAME,code:e[0].CODE,barcode:e[0].BARCODE,guid:e[0].GUID,vat:e[0].VAT},t.next=5,i.setBarcode();case 5:i.setState({tbBarcode:"visible"}),t.next=23;break;case 8:if(!(e.length>1)){t.next=23;break}n=0;case 10:if(!(n<e.length)){t.next=20;break}return i.txtBarcode.value=e[n].CODE,i.barcode={name:e[n].NAME,code:e[n].CODE,barcode:e[n].BARCODE,guid:e[0].GUID,vat:e[0].VAT},t.next=15,i.setBarcode();case 15:return t.next=17,i.addItem();case 17:n++,t.next=10;break;case 20:return a={id:"msgItemsAdd",showTitle:!0,title:i.t("msgItemsAdd.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:i.t("msgItemsAdd.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgItemsAdd.msg"))},t.next=23,(0,P.W)(a);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 2:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{id:"02",icon:"photo",onClick:(e=(0,r.Z)(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.barcodeScan();case 1:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})}],onEnterKey:function(){var t=(0,r.Z)(h().mark((function t(e){var n,a,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.component._changedValue){t.next=2;break}return t.abrupt("return");case 2:return n={query:"SELECT ITEM_CODE AS CODE,ITEM_NAME AS NAME,ITEM_GUID AS GUID,BARCODE, ISNULL((SELECT VAT FROM ITEMS WHERE ITEMS.GUID = ITEM_BARCODE_VW_01.ITEM_GUID),0) AS VAT FROM ITEM_BARCODE_VW_01  WHERE BARCODE = @BARCODE OR ITEM_CODE = @BARCODE ",param:["BARCODE:string|50"],value:[e.component._changedValue]},t.next=5,i.core.sql.execute(n);case 5:if(!((a=t.sent).result.recordset.length>0)){t.next=15;break}i.barcode.name=a.result.recordset[0].NAME,i.barcode.barcode=a.result.recordset[0].BARCODE,i.barcode.code=a.result.recordset[0].CODE,i.barcode.guid=a.result.recordset[0].GUID,i.barcode.vat=a.result.recordset[0].VAT,i.setBarcode(),t.next=19;break;case 15:return r={id:"msgBarcodeNotFound",showTitle:!0,title:i.t("msgBarcodeNotFound.title"),showCloseButton:!0,width:"350px",height:"200px",button:[{id:"btn01",caption:i.t("msgBarcodeNotFound.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgBarcodeNotFound.msg"))},t.next=18,(0,P.W)(r);case 18:i.txtBarcode.value="";case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)}))),m.createElement(O.Item,null,m.createElement("div",null,m.createElement("h4",{className:"text-center"},this.barcode.name))),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtQuantity")}),m.createElement(D.ZP,{id:"txtQuantity",parent:this,simple:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,param:this.param.filter({ELEMENT:"txtQuantity",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtQuantity",USERS:this.user.CODE}),onValueChanged:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.calculateItemPrice();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this),onEnterKey:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.addItem();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtPrice"),alignment:"right"}),m.createElement(D.ZP,{id:"txtPrice",parent:this,simple:!0,param:this.param.filter({ELEMENT:"txtPrice",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtPrice",USERS:this.user.CODE}),onValueChanged:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.calculateItemPrice();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this),onEnterKey:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.addItem();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtVat"),alignment:"right"}),m.createElement(g.ZP,{id:"txtVat",parent:this,simple:!0,readOnly:!0,param:this.param.filter({ELEMENT:"txtVat",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtVat",USERS:this.user.CODE})})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtAmount"),alignment:"right"}),m.createElement(g.ZP,{id:"txtAmount",parent:this,simple:!0,upper:this.sysParam.filter({ID:"onlyBigChar",USERS:this.user.CODE}).getValue().value,readOnly:!0,param:this.param.filter({ELEMENT:"txtAmount",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"txtAmount",USERS:this.user.CODE})})),m.createElement(O.Item,null,m.createElement("div",{className:"row"},m.createElement("div",{className:"col-12 px-1 pt-1"},m.createElement(w.Z,{text:this.t("btnItemAdd"),type:"default",width:"100%",onClick:function(){return i.addItem(i.txtQuantity.value)}})))))),m.createElement("div",{className:"row px-1 pt-1",style:{visibility:this.state.tbDocument,position:"absolute"}},m.createElement(T(),{colCount:1},m.createElement(O.Item,null,m.createElement("div",{className:"row",style:{height:"25px"}},m.createElement("div",{className:"col-4 px-1 pt-1"},m.createElement(w.Z,{icon:"arrowleft",type:"default",width:"100%",onClick:function(){return i.pageChange("Main")}})),m.createElement("div",{className:"col-4 px-1 pt-1"},m.createElement(w.Z,{icon:"plus",type:"default",width:"100%",onClick:function(){return i.pageChange("Barcode")}})),m.createElement("div",{className:"col-4"})))),m.createElement("div",{className:"col-12 px-2 pt-2"},m.createElement(T(),{colCount:1,onInitialized:function(t){i.frmDocItems=t.component}},m.createElement(O.Item,null,m.createElement(m.Fragment,null,m.createElement(A.ZP,{parent:this,id:"grdRebtDispatch",showBorders:!0,columnsAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,height:"350",width:"100%",dbApply:!1,onRowUpdated:function(){var t=(0,r.Z)(h().mark((function t(e){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.key.DISCOUNT>e.key.PRICE*e.key.QUANTITY)){t.next=5;break}return n={id:"msgDiscount",showTitle:!0,title:"Uyarı",showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:i.t("msgDiscount.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgDiscount.msg"))},(0,P.W)(n),e.key.DISCOUNT=0,t.abrupt("return");case 5:e.key.VAT>0&&(e.key.VAT=parseFloat(((e.key.PRICE*e.key.QUANTITY-e.key.DISCOUNT)*e.key.VAT_RATE/100).toFixed(3))),e.key.AMOUNT=parseFloat((e.key.PRICE*e.key.QUANTITY).toFixed(3)),e.key.TOTAL=parseFloat((e.key.PRICE*e.key.QUANTITY-e.key.DISCOUNT+e.key.VAT).toFixed(3)),e.key.DISCOUNT>0&&(e.key.DISCOUNT_RATE=parseFloat((100-(e.key.PRICE*e.key.QUANTITY-e.key.DISCOUNT)/(e.key.PRICE*e.key.QUANTITY)*100).toFixed(3))),i._calculateTotal();case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onRowRemoved:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i._calculateTotal(),t.next=3,i.docObj.save();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onContentReady:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.component.columnOption("command:edit","visibleIndex",-1);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},m.createElement(A.m_,{editOnKeyPress:!0,enterKeyAction:"moveFocus",enterKeyDirection:"row"}),m.createElement(A.PY,{mode:"standart"}),m.createElement(A.Po,{defaultPageSize:10}),m.createElement(A.uE,{visible:!0,allowedPageSizes:[5,10,20,50,100],showPageSizeSelector:!0}),m.createElement(A.LO,{mode:"cell",allowUpdating:!0,allowDeleting:!0,confirmDelete:!1}),m.createElement(A.sg,{dataField:"ITEM_NAME",caption:this.t("grdRebtDispatch.clmItemName"),width:150}),m.createElement(A.sg,{dataField:"QUANTITY",caption:this.t("grdRebtDispatch.clmQuantity"),dataType:"number",width:40}),m.createElement(A.sg,{dataField:"PRICE",caption:this.t("grdRebtDispatch.clmPrice"),dataType:"number",width:50,format:{style:"currency",currency:"EUR",precision:3}}),m.createElement(A.sg,{dataField:"ITEM_CODE",caption:this.t("grdRebtDispatch.clmItemCode"),width:150}),m.createElement(A.sg,{dataField:"AMOUNT",caption:this.t("grdRebtDispatch.clmAmount"),allowEditing:!1,format:{style:"currency",currency:"EUR",precision:3},width:80}),m.createElement(A.sg,{dataField:"VAT",caption:this.t("grdRebtDispatch.clmVat"),format:{style:"currency",currency:"EUR",precision:3},width:80,allowEditing:!1}),m.createElement(A.sg,{dataField:"TOTAL",caption:this.t("grdRebtDispatch.clmTotal"),format:{style:"currency",currency:"EUR",precision:3},width:100,allowEditing:!1})),m.createElement(C(),{dataSource:this.rightItems,width:200,target:"#grdRebtDispatch",onItemClick:function(){var t=(0,r.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i._getRebate();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}().bind(this)}))))),m.createElement("div",{className:"row px-1 pt-1"},m.createElement("div",{className:"col-12"},m.createElement(T(),{colCount:4,parent:this,id:"frmslsDoc"},m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtAmount"),alignment:"right"}),m.createElement(g.ZP,{id:"txtGrandAmount",parent:this,simple:!0,readOnly:!0,dt:{data:this.docObj.dt("DOC"),field:"AMOUNT"},maxLength:32})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtDiscount"),alignment:"right"}),m.createElement(g.ZP,{id:"txtGrandDiscount",parent:this,simple:!0,readOnly:!0,dt:{data:this.docObj.dt("DOC"),field:"DISCOUNT"},maxLength:32,button:[{id:"01",icon:"more",onClick:function(){i.docObj.dt()[0].DISCOUNT>0&&(i.txtDiscountPercent.value=parseFloat((100-(i.docObj.dt()[0].AMOUNT-i.docObj.dt()[0].DISCOUNT)/i.docObj.dt()[0].AMOUNT*100).toFixed(2)),i.txtDiscountPrice.value=i.docObj.dt()[0].DISCOUNT),i.popDiscount.show()}}]})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtVat"),alignment:"right"}),m.createElement(g.ZP,{id:"txtGrandVat",parent:this,simple:!0,readOnly:!0,dt:{data:this.docObj.dt("DOC"),field:"VAT"},maxLength:32,button:[{id:"01",icon:"clear",onClick:(t=(0,r.Z)(h().mark((function t(){var e,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={id:"msgVatDelete",showTitle:!0,title:i.t("msgVatDelete.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:i.t("msgVatDelete.btn01"),location:"before"},{id:"btn02",caption:i.t("msgSave.btn02"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgVatDelete.msg"))},t.next=3,(0,P.W)(e);case 3:if("btn01"==t.sent)for(n=0;n<i.docObj.docItems.dt().length;n++)i.docObj.docItems.dt()[n].VAT=0,i.docObj.docItems.dt()[n].VAT_RATE=0,i.docObj.docItems.dt()[n].TOTAL=i.docObj.docItems.dt()[n].PRICE*i.docObj.docItems.dt()[n].QUANTITY-i.docObj.docItems.dt()[n].DISCOUNT,i._calculateTotal();case 5:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}]})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtGrandTotal"),alignment:"right"}),m.createElement(g.ZP,{id:"txtGrandTotal",parent:this,simple:!0,readOnly:!0,dt:{data:this.docObj.dt("DOC"),field:"TOTAL"},maxLength:32})))))),m.createElement(R.Z,{id:"popItemCode",parent:this,container:"#root",visible:!1,position:{of:"#root"},showTitle:!0,showBorders:!0,width:"90%",height:"90%",title:this.t("popItemCode.title"),search:!0,selection:{mode:"single"},data:{source:{select:{query:"SELECT  *,  CASE WHEN UNDER_UNIT_VALUE =0  THEN 0 ELSE ROUND((PRICE * UNDER_UNIT_VALUE),2) END AS UNDER_UNIT_PRICE FROM  (  SELECT GUID,   CODE,   NAME,   VAT,   ISNULL((SELECT TOP 1 BARCODE FROM ITEM_BARCODE WHERE ITEM = ITEMS_VW_01.GUID ORDER BY CDATE DESC),'') AS BARCODE,   MAIN_GRP AS ITEM_GRP,   MAIN_GRP_NAME AS ITEM_GRP_NAME,   (SELECT [dbo].[FN_PRICE_SALE](GUID,1,GETDATE())) AS PRICE  , ISNULL((SELECT TOP 1 FACTOR FROM ITEM_UNIT WHERE TYPE = 1 AND ITEM_UNIT.ITEM = ITEMS_VW_01.GUID),0) AS UNDER_UNIT_VALUE FROM ITEMS_VW_01 WHERE ISNULL((SELECT TOP 1 BARCODE FROM ITEM_BARCODE WHERE ITEM = ITEMS_VW_01.GUID),'') <> '') AS TMP WHERE UPPER(CODE) LIKE UPPER(@VAL) OR UPPER(NAME) LIKE UPPER(@VAL) ",param:["VAL:string|50"]},sql:this.core.sql}}},m.createElement(A.sg,{dataField:"CODE",caption:this.t("popItemCode.clmCode"),width:100}),m.createElement(A.sg,{dataField:"NAME",caption:this.t("popItemCode.clmName"),defaultSortOrder:"asc"})),m.createElement("div",null,m.createElement(N.ZP,{parent:this,id:"popDiscount",visible:!1,showCloseButton:!0,showTitle:!0,title:this.t("popDiscount.title"),container:"#root",width:"350",height:"250",position:{of:"#root"}},m.createElement(T(),{colCount:1,height:"fit-content"},m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("popDiscount.Percent"),alignment:"right"}),m.createElement(D.ZP,{id:"txtDiscountPercent",parent:this,simple:!0,maxLength:32,onValueChanged:(0,r.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i.txtDiscountPercent.value>100)){t.next=7;break}return e={id:"msgDiscountPercent",showTitle:!0,title:i.t("msgDiscountPercent.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:i.t("msgDiscountPercent.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgDiscountPercent.msg"))},t.next=4,(0,P.W)(e);case 4:return i.txtDiscountPercent.value=0,i.txtDiscountPrice.value=0,t.abrupt("return");case 7:i.txtDiscountPrice.value=parseFloat((i.docObj.dt()[0].AMOUNT*i.txtDiscountPercent.value/100).toFixed(3));case 8:case"end":return t.stop()}}),t)}))).bind(this)})),m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("popDiscount.Price"),alignment:"right"}),m.createElement(D.ZP,{id:"txtDiscountPrice",parent:this,simple:!0,maxLength:32,onValueChanged:(0,r.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i.txtDiscountPrice.value>i.docObj.dt()[0].AMOUNT)){t.next=7;break}return e={id:"msgDiscountPrice",showTitle:!0,title:i.t("msgDiscountPrice.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:i.t("msgDiscountPrice.btn01"),location:"after"}],content:m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},i.t("msgDiscountPrice.msg"))},t.next=4,(0,P.W)(e);case 4:return i.txtDiscountPercent.value=0,i.txtDiscountPrice.value=0,t.abrupt("return");case 7:i.txtDiscountPercent.value=parseFloat((100-(i.docObj.dt()[0].AMOUNT-i.txtDiscountPrice.value)/i.docObj.dt()[0].AMOUNT*100).toFixed(3));case 8:case"end":return t.stop()}}),t)}))).bind(this)})),m.createElement(O.Item,null,m.createElement("div",{className:"row"},m.createElement("div",{className:"col-6"},m.createElement(w.Z,{text:this.lang.t("btnSave"),type:"normal",stylingMode:"contained",width:"100%",onClick:(0,r.Z)(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=0;e<i.docObj.docItems.dt().length;e++)i.docObj.docItems.dt()[e].DISCOUNT_RATE=i.txtDiscountPercent.value,i.docObj.docItems.dt()[e].DISCOUNT=parseFloat((i.docObj.docItems.dt()[e].PRICE*i.docObj.docItems.dt()[e].QUANTITY*i.txtDiscountPercent.value/100).toFixed(3)),i.docObj.docItems.dt()[e].VAT>0&&(i.docObj.docItems.dt()[e].VAT=parseFloat((i.docObj.docItems.dt()[e].PRICE*i.docObj.docItems.dt()[e].QUANTITY*(i.docObj.docItems.dt()[e].VAT_RATE/100)).toFixed(3))),i.docObj.docItems.dt()[e].TOTAL=parseFloat((i.docObj.docItems.dt()[e].PRICE*i.docObj.docItems.dt()[e].QUANTITY+i.docObj.docItems.dt()[e].VAT-i.docObj.docItems.dt()[e].DISCOUNT).toFixed(3));i._calculateTotal(),i.popDiscount.hide();case 3:case"end":return t.stop()}}),t)})))})),m.createElement("div",{className:"col-6"},m.createElement(w.Z,{text:this.lang.t("btnCancel"),type:"normal",stylingMode:"contained",width:"100%",onClick:function(){i.popDiscount.hide()}}))))))),m.createElement(P.Z,{id:"msgQuantity",container:"#root",parent:this,position:{of:"#root"},showTitle:!0,title:this.t("msgQuantity.title"),showCloseButton:!1,width:"350px",height:"250px",button:[{id:"btn01",caption:this.t("msgQuantity.btn01"),location:"after"}]},m.createElement("div",{className:"row"},m.createElement("div",{className:"col-12 py-2"},m.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgQuantity.msg"))),m.createElement("div",{className:"col-12 py-2"},m.createElement(T(),null,m.createElement(O.Item,null,m.createElement(O.Label,{text:this.t("txtQuantity"),alignment:"right"}),m.createElement(D.ZP,{id:"txtPopQuantity",parent:this,simple:!0}))))),m.createElement("div",{className:"row"})))))}}]),B}(m.PureComponent)}}]);